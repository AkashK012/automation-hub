{
  "name": "Daily Shift & Incident Report Generator and Conditional Logger",
  "nodes": [
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const formData = $json;\n\n// Check if incident exists\nconst hasIncident = formData['Did any incidents occur during this shift?']?.toLowerCase().includes('yes') ||\n                   formData['Incident Date and Time'] ||\n                   formData['Location of Incident'];\n\n\nif (!hasIncident) {\n    throw new Error(\"SKIP_NO_INCIDENT\");  // This will skip the item\n}\n\n// Extract info\nconst staffName = formData['Staff Full Name'] || 'Unknown Staff';\nconst clientName = formData['Participant Full Name'] || 'Unknown Client';\nconst location = formData['Shift Location'] || '';\nconst cleanClientName = clientName.replace(/[^a-zA-Z0-9]/g, '_');\nconst today = new Date().toISOString().split('T')[0];\nconst timestamp = new Date().toLocaleString();\n\nconst incidentContent = `\nCRITICAL INCIDENT REPORT\n========================\n\nPRIORITY LEVEL: CRITICAL - IMMEDIATE MANAGEMENT ATTENTION REQUIRED\n\nPERSONNEL INFORMATION\n---------------------\nClient: ${clientName}\nStaff Member: ${staffName}\nLocation: ${location}\nReport Generated: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\n\nINCIDENT DETAILS\n----------------\nDate & Time: ${formData['Incident Date and Time'] || 'NOT SPECIFIED'}\nLocation: ${formData['Location of Incident'] || 'NOT SPECIFIED'}\nPeople Involved: ${formData['People Involved'] || 'NOT SPECIFIED'}\nIncident Confirmed: ${formData['Did any incidents occur during this shift?'] || 'Detected from field data'}\n\nINCIDENT DESCRIPTION\n--------------------\nWhat Happened: ${formData['Describe What Happened'] || 'NO DESCRIPTION PROVIDED'}\nLead-up Events: ${formData['What led up to the incident?'] || 'NOT SPECIFIED'}\n\nRESPONSE & OUTCOME\n------------------\nActions Taken: ${formData['Actions Taken / Response'] || 'NO ACTIONS RECORDED'}\nIncident Outcome: ${formData['Outcome of the Incident'] || 'OUTCOME NOT RECORDED'}\n\nREPORTING & FOLLOW-UP\n---------------------\nReported To: ${formData['Was it reported? If yes, to whom and how?'] || 'REPORTING STATUS UNKNOWN'}\nRecommendations: ${formData['Follow-up / Recommendations'] || 'NO RECOMMENDATIONS PROVIDED'}\n\nURGENT ACTION REQUIRED - MANAGEMENT REVIEW NEEDED\n\nREPORT DETAILS\n--------------\nReport ID: INC-${Date.now()}\nGenerated: ${timestamp}\nStaff Member: ${staffName}\nStatus: REQUIRES IMMEDIATE ATTENTION\n`;\n\nreturn {\n    json: {\n        type: 'report',\n        reportType: 'incident',\n        title: `INCIDENT_REPORT_${cleanClientName}_${today}`,\n        content: incidentContent,\n        clientName: clientName,\n        staffName: staffName,\n        priority: 'CRITICAL'\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        80
      ],
      "id": "4f0e29c5-57ea-4e39-9227-8789a786ddb1",
      "name": "Check Incident",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "inputDataFieldName": "pdf",
        "name": "={{ $json.title }}.pdf",
        "driveId": {
          "__rl": true,
          "value": "=My Drive",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $json.targetFolderId }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2272,
        768
      ],
      "id": "869cf32a-4b63-4a22-ae7b-0c9350c61998",
      "name": "Save Shift Report"
    },
    {
      "parameters": {
        "inputDataFieldName": "pdf",
        "name": "={{ $json.title }}.pdf",
        "driveId": {
          "__rl": true,
          "value": "=My Drive",
          "mode": "id"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $json.targetFolderId }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2272,
        976
      ],
      "id": "9cac2494-98c8-4730-af4c-477740ea52da",
      "name": "Save Incident Report"
    },
    {
      "parameters": {
        "sendTo": "akash.kunwar@younglogix.com.au",
        "subject": "=üö® URGENT: {{ $json.title }}",
        "emailType": "text",
        "message": "=üö® CRITICAL INCIDENT ALERT üö®\n\nPlease find the detailed incident report attached.\n\nKey Details:\n- Client: {{ $json.clientName }}\n- Staff: {{ $json.staffName }}  \n- Time: {{ new Date().toLocaleString() }}\n\nThe full report is attached as a Google Doc.\nPlease take immediate action as required.",
        "options": {
          "attachmentsUi": {
            "attachmentsBinary": [
              {
                "property": "pdf"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2480,
        1216
      ],
      "id": "1d1212f8-e660-4045-b247-7d358a4de8ac",
      "name": "Email Incident Report",
      "webhookId": "5dea15a7-05be-4d57-92b2-319696337c4b"
    },
    {
      "parameters": {
        "jsCode": "// Healthcare Shift Conditional Logger - FIXED VERSION\nconst allItems = $input.all();\nconst allLogs = [];\n\n// Process each form response\nallItems.forEach(item => {\n  const formData = item.json;\n  const timestamp = new Date().toISOString();\n\n  // Helper function\n  function getValue(fieldName, defaultValue = '') {\n    return formData[fieldName] || defaultValue;\n  }\n\n  // Base info for all logs - FIXED: Use correct column name\n  const baseInfo = {\n    'Timestamp': timestamp,\n    'Participant Full Name': getValue('Participant Full Name', 'Unknown'), // FIXED: Direct mapping\n    'Staff Name': getValue('Staff Full Name', 'Unknown'),\n    'Shift Date': getValue('Sign In Date & Time', timestamp),\n    'Location': getValue('Shift Location', 'Unknown')\n  };\n\n  const logsToCreate = [];\n\n  // 1. NUTRITION ISSUES\n  const nutritionAnswer = getValue('Did the participant consume adequate food or fluids?', '').toLowerCase();\n  if (nutritionAnswer.includes('no')) {\n    logsToCreate.push({\n      sheetName: 'Nutrition_Issues_Log',\n      data: {\n        ...baseInfo,\n        'Adequate Consumption': getValue('Did the participant consume adequate food or fluids?'),\n        'Reason': getValue('If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?'),\n        'Meal Details': getValue('Meal Details'),\n        'Hydration Intake': getValue('Hydration Intake'),\n        'Actions Taken': getValue('If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?')\n      }\n    });\n  }\n\n  // 2. SWALLOWING DIFFICULTIES\n  const swallowingAnswer = getValue('Did the participant have any difficulty chewing or swallowing during meals or with fluids?', '').toLowerCase();\n  if (swallowingAnswer.includes('yes')) {\n    logsToCreate.push({\n      sheetName: 'Swallowing_Difficulties_Log',\n      data: {\n        ...baseInfo,\n        'Difficulty Reported': 'Yes',\n        'Description': getValue('Explain the difficulty in chewing or swallowing experienced during meals and with fluids, and what actions were taken by staff.'),\n        'Actions Taken': getValue('Explain the difficulty in chewing or swallowing experienced during meals and with fluids, and what actions were taken by staff.')\n      }\n    });\n  }\n\n  // 3. CHOKING/DISCOMFORT\n  const chokingAnswer = getValue('Were there any signs of choking, coughing, or discomfort while eating or drinking?', '').toLowerCase();\n  if (chokingAnswer.includes('yes')) {\n    const chokingDetails = getValue('Were there any signs of choking, coughing, or discomfort while eating or drinking? If yes, explain the possible cause and describe the actions taken by staff.');\n    logsToCreate.push({\n      sheetName: 'Choking_Discomfort_Log',\n      data: {\n        ...baseInfo,\n        'Signs Observed': 'Yes',\n        'Details': chokingDetails,\n        'Possible Cause': chokingDetails,\n        'Actions Taken': chokingDetails\n      }\n    });\n  }\n\n  // 4. MEDICATION ADMINISTRATION\n  const medsAnswer = getValue('Were any medications administered during this shift?', '').toLowerCase();\n  if (medsAnswer.includes('yes')) {\n    logsToCreate.push({\n      sheetName: 'Medication_Admin_Log',\n      data: {\n        ...baseInfo,\n        'Medications Administered': getValue('Were any medications administered during this shift?'),\n        'Medication Time': getValue('Medication time'),\n        'Medication Source': getValue('Medication source'),\n        'Medications List': getValue('list all medications administered (if applicable)'),\n        'Method': getValue('Method of administration'),\n        'Issues/Observations': getValue('Any issues or observations during administration?')\n      }\n    });\n  }\n\n  // 5. PRN MEDICATIONS (up to 3)\n  for (let i = 1; i <= 3; i++) {\n    const prnName = getValue(`PRN${i} Medication name`);\n    if (prnName) {\n      logsToCreate.push({\n        sheetName: 'PRN_Medication_Log',\n        data: {\n          ...baseInfo,\n          'PRN Number': `PRN${i}`,\n          'Medication Name': prnName,\n          'Dose': getValue(`PRN${i} Dose`),\n          'Time Given': getValue(`PRN${i} Time given`),\n          'Reason': getValue(`PRN${i} Reason for administration`),\n          'Effect/Outcome': getValue(`PRN${i} Effect/Outcome observed`)\n        }\n      });\n    }\n  }\n\n  // 6. COMMUNITY PARTICIPATION ISSUES\n  const communityAnswer = getValue('Did the participant participate in any community activities today?', '').toLowerCase();\n  if (communityAnswer.includes('no')) {\n    logsToCreate.push({\n      sheetName: 'Community_Participation_Issues_Log',\n      data: {\n        ...baseInfo,\n        'Participated': 'No',\n        'Reason Not Attended': getValue('Why did the participant not attend the community activity today?'),\n        'Response When Offered': getValue('How did the participant respond when the activity was offered?'),\n        'Informed in Advance': getValue('Were they informed and prepared for the activity in advance?'),\n        'Barriers': getValue('Were there any barriers like transport, timing, or resources that affected participation?'),\n        'Signs of Concern': getValue('Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?'),\n        'Strategies Used': getValue('What steps or strategies did you take to encourage or motivate participation?'),\n        'Future Improvements': getValue('What could be done differently next time to support engagement?'),\n        'Resources Needed': getValue('Do you require any resources or guidance to better facilitate participation?')\n      }\n    });\n  }\n\n  // 7. IRC (Issues/Risks/Challenges)\n  const ircAnswer = getValue('Did you face any issues, risks, or challenges during the shift?', '').toLowerCase();\n  if (ircAnswer.includes('yes')) {\n    for (let i = 1; i <= 3; i++) {\n      const ircType = getValue(`Type of IRC (Issue/Risk/Challenge) ${i}`);\n      if (ircType) {\n        logsToCreate.push({\n          sheetName: 'IRC_Log',\n          data: {\n            ...baseInfo,\n            'IRC Number': `IRC${i}`,\n            'Type': ircType,\n            'Description': getValue(`Describe the IRC ( issues, risks, or challenges) ${i}`)\n          }\n        });\n      }\n    }\n  }\n\n  // 8. INCIDENTS\n  const incidentAnswer = getValue('Did any incidents occur during this shift?', '').toLowerCase();\n  const hasIncident = incidentAnswer.includes('yes') || \n                     getValue('Incident Date and Time') || \n                     getValue('Location of Incident');\n\n  if (hasIncident) {\n    logsToCreate.push({\n      sheetName: 'Incident_Log',\n      data: {\n        ...baseInfo,\n        'Incident Date/Time': getValue('Incident Date and Time'),\n        'Incident Location': getValue('Location of Incident'),\n        'People Involved': getValue('People Involved'),\n        'Description': getValue('Describe What Happened'),\n        'Lead-up Events': getValue('What led up to the incident?'),\n        'Actions Taken': getValue('Actions Taken / Response'),\n        'Outcome': getValue('Outcome of the Incident'),\n        'Reported To': getValue('Was it reported? If yes, to whom and how?'),\n        'Follow-up': getValue('Follow-up / Recommendations')\n      }\n    });\n  }\n\n  // 9. APPOINTMENTS\n  const appointmentAnswer = getValue('Were there any appointments during this shift?', '').toLowerCase();\n  if (appointmentAnswer.includes('yes')) {\n    logsToCreate.push({\n      sheetName: 'Appointments_Log',\n      data: {\n        ...baseInfo,\n        'Appointment Type': getValue('Type of Appointment'),\n        'Purpose': getValue('Purpose of the Appointment'),\n        'Reason': getValue('Reason for the Visit'),\n        'Requested By': getValue('Who Requested the Appointment?'),\n        'Planned/Urgent': getValue('Was this Appointment Planned or Urgent?'),\n        'Clinic Name': getValue('Name of Clinic or Service'),\n        'Professional Name': getValue('Name of the Professional Seen'),\n        'Appointment Location': getValue('Location'),\n        'Contact Number': getValue('Contact Number of Clinic/Professional'),\n        'Summary': getValue('Brief Summary of the Appointment'),\n        'Follow Up Actions': getValue('Follow Up Actions Required'),\n        'Next Appointment': getValue('Next Appointment Date (if scheduled)'),\n        'Documents Provided': getValue('Were any documents provided?'),\n        'Participant Response': getValue(\"Participant's Response or Reaction\"),\n        'Actions Taken': getValue('What actions were taken immediately, and what actions still need to be taken?')\n      }\n    });\n  }\n\n  // 10. SHIFT DIFFICULTIES\n  const shiftRating = getValue('How did your shift go today?', '').toLowerCase();\n  if (shiftRating.includes('difficult') || shiftRating.includes('very difficult')) {\n    logsToCreate.push({\n      sheetName: 'Shift_Difficulties_Log',\n      data: {\n        ...baseInfo,\n        'Shift Rating': getValue('How did your shift go today?'),\n        'Explanation': getValue('If you rated the shift as Difficult or Very Difficult, please explain why.'),\n        'Support Needed': getValue('Did you need any additional support, resources, or information during your shift?')\n      }\n    });\n  }\n\n  // 11. STAFF CONCERNS\n  const concernsAnswer = getValue('Did you experience any concerns or issues during your shift that you\\'d like to report?', '').toLowerCase();\n  if (concernsAnswer.includes('yes')) {\n    logsToCreate.push({\n      sheetName: 'Staff_Concerns_Log',\n      data: {\n        ...baseInfo,\n        'Concerns Reported': 'Yes',\n        'Details': getValue('Would you like to provide more details about any concerns, issues, or complaints raised during this shift? If yes, please describe what happened and any actions taken.'),\n        'Physical/Emotional State': getValue('How are you feeling physically and emotionally after this shift?'),\n        'Management Awareness': getValue('Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?'),\n        'Follow-up Requested': getValue('Would you like someone to follow up with you?')\n      }\n    });\n  }\n\n  // 12. TRAINING NEEDS\n  const trainingAnswer = getValue('Do you feel you need additional training or support?', '').toLowerCase();\n  if (trainingAnswer.includes('yes')) {\n    logsToCreate.push({\n      sheetName: 'Training_Needs_Log',\n      data: {\n        ...baseInfo,\n        'Training Needed': 'Yes',\n        'Training Areas': getValue('Which areas do you feel you need training in?'),\n        'Support Type': getValue('What type of support would help you most?')\n      }\n    });\n  }\n\n  // Add all logs to the main array\n  allLogs.push(...logsToCreate);\n});\n\n// FIXED: Return data with sheetName for routing, but create separate output for sheets\nreturn allLogs.map(log => {\n  return {\n    json: {\n      // Include sheetName for the Switch node routing\n      sheetName: log.sheetName,\n      // Include all the log data\n      ...log.data\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1168,
        1600
      ],
      "id": "989b621f-8054-45a1-98b6-52cdf4b72236",
      "name": "Conditional Logger"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        880,
        1600
      ],
      "id": "b82a0ccd-e9da-40d6-8c6a-bd0e13be95ab",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me2",
      "typeVersion": 1,
      "position": [
        1024,
        1808
      ],
      "id": "779ba65b-fc8f-4764-ba6b-049e9d70ec2e"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Nutrition_Issues_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7ae8a28c-1dc3-4711-9328-477ab20816c3"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f46143aa-d161-4660-90b2-96780da058c3",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Swallowing_Difficulties_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e1e62aef-c65f-4b3d-82ba-cb0ad0ed909f",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Choking_Discomfort_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1bd76542-f317-41dd-a8dc-e2abe573b9a4",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Medication_Admin_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ab6327fe-6ddd-439b-bd83-635ba7f25613",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "PRN_Medication_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0b05ccbb-1d12-4ea2-bfbe-1b1795bf4d8e",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Community_Participation_Issues_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cb5dab69-8936-4d70-9d3e-c29f8fe48185",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "IRC_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b5a204c2-c93f-4436-bdf3-d1bf1c8c5cf9",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Incident_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "138d1f4a-888c-4367-bca7-193558f2d62d",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Appointments_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "baf351f3-5b99-4757-ac16-559bed1773a1",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Shift_Difficulties_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bcb49b1e-3b33-4f2a-a47c-00dcce146979",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Staff_Concerns_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2bfee689-d521-439a-9a47-ba328b45e063",
                    "leftValue": "={{ $json.sheetName }}",
                    "rightValue": "Training_Needs_Log",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1552,
        1488
      ],
      "id": "c1d9d140-dacf-4453-81c8-dd78d64e3e91",
      "name": "Route By Sheet Name"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.sheetName }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Participant Full Name",
              "displayName": "Participant Full Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Staff Name",
              "displayName": "Staff Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shift Date",
              "displayName": "Shift Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Location",
              "displayName": "Location",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Medications Administered",
              "displayName": "Medications Administered",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Medication Time",
              "displayName": "Medication Time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Medication Source",
              "displayName": "Medication Source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Medications List",
              "displayName": "Medications List",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Method",
              "displayName": "Method",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Issues/Observations",
              "displayName": "Issues/Observations",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sheetName",
              "displayName": "sheetName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "=RAW"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2624,
        1648
      ],
      "id": "694420d0-551e-4d5a-b8b4-1c2e7eb270fc",
      "name": "Universal Append"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2960,
        1648
      ],
      "id": "d16bedfd-d6cc-457d-b014-7a7a4bc1c3f4",
      "name": "End of Loop"
    },
    {
      "parameters": {
        "jsCode": "// CORRECT FIX: Keep sheetName for Google Sheets routing but exclude it from column mapping\nconst cleanedItems = $input.all().map(item => {\n  const originalData = item.json;\n  \n  return {\n    json: {\n      // Keep sheetName for Google Sheets node to use for routing\n      sheetName: originalData.sheetName,\n      // Include all other data\n      ...Object.fromEntries(\n        Object.entries(originalData).filter(([key]) => key !== 'sheetName')\n      )\n    }\n  };\n});\n\nreturn cleanedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2464,
        1648
      ],
      "id": "5429df36-abbc-49a2-9de9-e912550f1896",
      "name": "Clean Data Node"
    },
    {
      "parameters": {
        "jsCode": "// CORRECTED Test Data Node - Ensures no undefined values\nconst testFormData = {\n  // Basic Info\n  \"Participant Full Name\": \"John Smith\",\n  \"Staff Full Name\": \"Sarah Johnson\", \n  \"Sign In Date & Time\": \"2024-09-05 09:00:00\",\n  \"Shift Location\": \"Community House A\",\n  \n  // NUTRITION - Will trigger Nutrition_Issues_Log\n  \"Did the participant consume adequate food or fluids?\": \"No, refused breakfast\",\n  \"If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?\": \"Participant refused breakfast due to nausea. Offered light snacks and encouraged small sips of water. Contacted nurse for advice.\",\n  \"Meal Details\": \"Refused breakfast, ate half lunch, normal dinner\",\n  \"Hydration Intake\": \"Limited water intake in morning, improved afternoon\",\n  \n  // SWALLOWING - Will trigger Swallowing_Difficulties_Log\n  \"Did the participant have any difficulty chewing or swallowing during meals or with fluids?\": \"Yes, during lunch\",\n  \"Explain the difficulty in chewing or swallowing experienced during meals and with fluids, and what actions were taken by staff.\": \"Participant coughed while drinking water and had difficulty swallowing solid foods. Switched to pureed foods and thickened fluids. Monitored closely during meals.\",\n  \n  // CHOKING - Will trigger Choking_Discomfort_Log\n  \"Were there any signs of choking, coughing, or discomfort while eating or drinking?\": \"Yes, during water intake\",\n  \"Were there any signs of choking, coughing, or discomfort while eating or drinking? If yes, explain the possible cause and describe the actions taken by staff.\": \"Participant coughed repeatedly when drinking thin liquids. Possible cause: swallowing difficulty. Action: Switched to thickened fluids and positioned upright.\",\n  \n  // MEDICATION - Will trigger Medication_Admin_Log\n  \"Were any medications administered during this shift?\": \"Yes, regular medications\",\n  \"Medication time\": \"08:00, 14:00, 20:00\",\n  \"Medication source\": \"Webster pack and PRN box\",\n  \"list all medications administered (if applicable)\": \"Paracetamol 500mg, Blood pressure tablet, Vitamin D\",\n  \"Method of administration\": \"Oral with water and food\",\n  \"Any issues or observations during administration?\": \"No issues, participant cooperative\",\n  \n  // PRN MEDICATIONS - Will trigger PRN_Medication_Log (3 entries)\n  \"PRN1 Medication name\": \"Paracetamol\",\n  \"PRN1 Dose\": \"500mg\",\n  \"PRN1 Time given\": \"15:30\",\n  \"PRN1 Reason for administration\": \"Complained of headache\",\n  \"PRN1 Effect/Outcome observed\": \"Headache resolved within 1 hour\",\n  \n  \"PRN2 Medication name\": \"Ventolin Inhaler\",\n  \"PRN2 Dose\": \"2 puffs\",\n  \"PRN2 Time given\": \"11:45\",\n  \"PRN2 Reason for administration\": \"Shortness of breath during activity\",\n  \"PRN2 Effect/Outcome observed\": \"Breathing improved, completed activity\",\n  \n  \"PRN3 Medication name\": \"Lorazepam\",\n  \"PRN3 Dose\": \"0.5mg\",\n  \"PRN3 Time given\": \"16:00\",\n  \"PRN3 Reason for administration\": \"Anxiety before medical appointment\",\n  \"PRN3 Effect/Outcome observed\": \"Became calmer, able to attend appointment\",\n  \n  // COMMUNITY PARTICIPATION - Will trigger Community_Participation_Issues_Log\n  \"Did the participant participate in any community activities today?\": \"No, refused to attend\",\n  \"Why did the participant not attend the community activity today?\": \"Feeling tired and anxious about new people\",\n  \"How did the participant respond when the activity was offered?\": \"Said 'I don't want to go today' and became withdrawn\",\n  \"Were they informed and prepared for the activity in advance?\": \"Yes, discussed yesterday and this morning\",\n  \"Were there any barriers like transport, timing, or resources that affected participation?\": \"No transport issues, but participant was tired\",\n  \"Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?\": \"Yes, appeared fatigued and anxious\",\n  \"What steps or strategies did you take to encourage or motivate participation?\": \"Offered to accompany them, suggested shorter visit, provided reassurance\",\n  \"What could be done differently next time to support engagement?\": \"Start with smaller groups, visit at a better time when less tired\",\n  \"Do you require any resources or guidance to better facilitate participation?\": \"Would like guidance on anxiety management techniques\",\n  \n  // IRC - Will trigger IRC_Log (3 entries)\n  \"Did you face any issues, risks, or challenges during the shift?\": \"Yes, multiple challenges\",\n  \"Type of IRC (Issue/Risk/Challenge) 1\": \"Risk\",\n  \"Describe the IRC ( issues, risks, or challenges) 1\": \"Participant became dizzy when standing up quickly. Risk of falls identified.\",\n  \"Type of IRC (Issue/Risk/Challenge) 2\": \"Issue\", \n  \"Describe the IRC ( issues, risks, or challenges) 2\": \"Hot water system not working properly - lukewarm water only.\",\n  \"Type of IRC (Issue/Risk/Challenge) 3\": \"Challenge\",\n  \"Describe the IRC ( issues, risks, or challenges) 3\": \"Participant's family called upset about care plan changes - took 30 minutes to resolve.\",\n  \n  // INCIDENTS - Will trigger Incident_Log\n  \"Did any incidents occur during this shift?\": \"Yes, minor incident\",\n  \"Incident Date and Time\": \"2024-09-05 14:30\",\n  \"Location of Incident\": \"Kitchen area\",\n  \"People Involved\": \"John Smith (participant), Sarah Johnson (staff)\",\n  \"Describe What Happened\": \"Participant knocked over a glass of water while reaching for medication\",\n  \"What led up to the incident?\": \"Participant was rushing to take medication before activity\",\n  \"Actions Taken / Response\": \"Cleaned up immediately, checked participant for injuries, no harm done\",\n  \"Outcome of the Incident\": \"No injuries, participant more careful afterwards\",\n  \"Was it reported? If yes, to whom and how?\": \"Reported to team leader via phone call\",\n  \"Follow-up / Recommendations\": \"Suggest keeping water glasses away from medication area\",\n  \n  // APPOINTMENTS - Will trigger Appointments_Log\n  \"Were there any appointments during this shift?\": \"Yes, medical appointment\",\n  \"Type of Appointment\": \"Medical consultation\",\n  \"Purpose of the Appointment\": \"Regular check-up and medication review\",\n  \"Reason for the Visit\": \"Scheduled 3-month review with GP\",\n  \"Who Requested the Appointment?\": \"GP clinic - routine follow-up\",\n  \"Was this Appointment Planned or Urgent?\": \"Planned\",\n  \"Name of Clinic or Service\": \"Westside Medical Centre\",\n  \"Name of the Professional Seen\": \"Dr. Amanda Chen\",\n  \"Location\": \"123 Medical Street, Westside\",\n  \"Contact Number of Clinic/Professional\": \"02 9876 5432\",\n  \"Brief Summary of the Appointment\": \"General health check, blood pressure good, medication reviewed. Dr happy with progress.\",\n  \"Follow Up Actions Required\": \"Book blood test in 2 weeks, continue current medications\",\n  \"Next Appointment Date (if scheduled)\": \"2024-12-05\",\n  \"Were any documents provided?\": \"Yes, updated care plan and blood test form\",\n  \"Participant's Response or Reaction\": \"Pleased with positive feedback from doctor\",\n  \"What actions were taken immediately, and what actions still need to be taken?\": \"Updated medication chart immediately. Still need to book blood test appointment.\",\n  \n  // SHIFT DIFFICULTIES - Will trigger Shift_Difficulties_Log\n  \"How did your shift go today?\": \"Difficult\",\n  \"If you rated the shift as Difficult or Very Difficult, please explain why.\": \"Multiple challenges with participant's health concerns, family phone call, and incident management. Felt understaffed.\",\n  \"Did you need any additional support, resources, or information during your shift?\": \"Yes, could have used a second staff member during the medical appointment\",\n  \n  // STAFF CONCERNS - Will trigger Staff_Concerns_Log\n  \"Did you experience any concerns or issues during your shift that you'd like to report?\": \"Yes, several concerns\",\n  \"Would you like to provide more details about any concerns, issues, or complaints raised during this shift? If yes, please describe what happened and any actions taken.\": \"Participant's anxiety levels seem to be increasing. Family expressed dissatisfaction with communication. Need better coordination between staff shifts.\",\n  \"How are you feeling physically and emotionally after this shift?\": \"Tired and somewhat stressed, but satisfied that participant was well cared for\",\n  \"Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?\": \"Participant may need mental health support referral. Hot water system needs urgent repair. Family communication protocol needs review.\",\n  \"Would you like someone to follow up with you?\": \"Yes, would appreciate debrief with team leader\",\n  \n  // TRAINING NEEDS - Will trigger Training_Needs_Log\n  \"Do you feel you need additional training or support?\": \"Yes, in specific areas\",\n  \"Which areas do you feel you need training in?\": \"Anxiety management techniques, family communication, incident reporting\",\n  \"What type of support would help you most?\": \"Mentoring from experienced staff, additional training workshops, clearer protocols\"\n};\n\n// Debug: Log the keys to see what we're providing\nconsole.log('Test data fields:', Object.keys(testFormData));\n\n// Return the test data as a single item\nreturn [{ json: testFormData }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        704,
        80
      ],
      "id": "578026b3-2aff-4155-8e2f-7fcacb1dea6c",
      "name": "Test data"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// v2.0 - Simplified routing using standardized codes\nconst clientCode = $json.clientCode || 'CT999';\nconst clientName = $json.clientName || 'Unknown Client';\n\nconst shiftFolderMap = {\n    'CT001': '1fEYjnFkxDTAJuAVW2Fc7WIYjCV-FBP6n',\n    'CT002': '19i5yNRsLj5ESVMcWb5eVLyxp9QdoETcB',\n    'CT003': '1oOpT2VHwjlq60VaxTi9kKgll1iHZCsPD',\n    'CT004': '12z00YR6ognCEFybGf433x_6XuHRjEnCP',\n    'CT005': '1NjkgkgQQivsZe-hC2P1o3v7oY_sVcOVU',\n  \n    'CT006': '18GVkOrmScWkGKMFtGfguckTBKWsEmnZ_',\n    'CT007': '1oeLJ1MKRBB8YBQM-OQurl1e1leQIMd-I'\n    \n};\n\nconst targetFolderId = shiftFolderMap[clientCode] || '1GRSAYhplQYGd5URczWzQh1Xsvz7VIQ63';\n\nconsole.log(`=== SHIFT REPORT ROUTING v2.0 ===`);\nconsole.log(`Input: \"${$json.originalClientName}\"`);\nconsole.log(`Matched: ${$json.clientMatched ? 'YES' : 'NO'}`);\nconsole.log(`Code: ${clientCode}`);\nconsole.log(`Standardized: ${clientName}`);\nconsole.log(`Folder: ${targetFolderId}`);\n\nif (clientCode === 'CT999') {\n    console.warn(`‚ö†Ô∏è UNMATCHED CLIENT - Review name variations in NameCodeManager`);\n}\n\nreturn {\n    json: { ...($json), targetFolderId },\n    binary: $input.item.binary\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2016,
        768
      ],
      "id": "c4ad876e-e394-4bb5-a9c6-c489f1fb7b68",
      "name": "Get Shift Report Folder ID"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// v2.0 - Simplified routing using standardized codes\nconst clientCode = $json.clientCode || 'CT999';\nconst clientName = $json.clientName || 'Unknown Client';\n\nconst incidentFolderMap = {\n    'CT001': '1ICOfMZH0czrtR1O84KFHpAh2AbnOP2eD',\n    'CT002': '1dxh-7treeUca03MXajhmOKUQluS9VrZA',\n    'CT003': '1e_mczHFQ69Ir49ARHOMTLtrHh3tqySdU',\n    'CT004': '1itw5t7EM9XlCZpxAiol43ZUOu1dM6VrS',\n    'CT005': '1rjmigy9Ut8eI_bSwQUXdiowWQDs5TxXi',\n    \n    'CT006': '1YpkeEkuxf4kLrJtB5rBedM0TeVlQVLoO',\n    'CT007': '1sx7ppe7dtvuqa_dgooVZkK18IYvckcrB',\n    \n};\n\nconst targetFolderId = incidentFolderMap[clientCode] || '1GRSAYhplQYGd5URczWzQh1Xsvz7VIQ63';\n\nconsole.log(`=== INCIDENT REPORT ROUTING v2.0 ===`);\nconsole.log(`Input: \"${$json.originalClientName}\"`);\nconsole.log(`Matched: ${$json.clientMatched ? 'YES' : 'NO'}`);\nconsole.log(`Code: ${clientCode}`);\nconsole.log(`Standardized: ${clientName}`);\nconsole.log(`Folder: ${targetFolderId}`);\n\nif (clientCode === 'CT999') {\n    console.warn(`‚ö†Ô∏è UNMATCHED CLIENT - Review name variations in NameCodeManager`);\n}\n\nreturn {\n    json: { ...($json), targetFolderId },\n    binary: $input.item.binary\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2048,
        960
      ],
      "id": "1b43f940-bf33-456a-b688-8ee4a37b1bce",
      "name": "Get Incident Report Folder ID"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        48,
        80
      ],
      "id": "a93ea806-2fc5-4e83-974f-b6d4c2c23f95",
      "name": "Read Form Responses"
    },
    {
      "parameters": {
        "jsCode": "// NAME ANALYSIS & DIRECTORY BUILDER\n// Use this in a temporary n8n Code node to analyze your real form data\n\n// Step 1: Analyze your real form data\nconst formResponses = $input.all(); // Your actual form data\n\nconst staffNames = new Set();\nconst clientNames = new Set();\nconst fieldNames = new Set();\n\nconsole.log('=== ANALYZING REAL FORM DATA ===');\n\nformResponses.forEach(item => {\n    const response = item.json;\n    \n    // Collect all field names to identify exact column names\n    Object.keys(response).forEach(field => fieldNames.add(field));\n    \n    // Try to identify staff name field (adjust these patterns to match your form)\n    const staffFields = Object.keys(response).filter(field => \n        field.toLowerCase().includes('staff') && \n        field.toLowerCase().includes('name')\n    );\n    \n    // Try to identify client name field\n    const clientFields = Object.keys(response).filter(field => \n        (field.toLowerCase().includes('participant') || \n         field.toLowerCase().includes('client') || \n         field.toLowerCase().includes('consumer')) &&\n        field.toLowerCase().includes('name')\n    );\n    \n    // Extract staff names\n    staffFields.forEach(field => {\n        const name = response[field];\n        if (name && name.trim() !== '') {\n            staffNames.add(name.trim());\n        }\n    });\n    \n    // Extract client names  \n    clientFields.forEach(field => {\n        const name = response[field];\n        if (name && name.trim() !== '') {\n            clientNames.add(name.trim());\n        }\n    });\n});\n\nconsole.log('\\n=== FIELD NAMES FOUND ===');\nconsole.log('All field names in your form:');\nArray.from(fieldNames).sort().forEach(field => {\n    console.log(`\"${field}\"`);\n});\n\nconsole.log('\\n=== STAFF NAMES FOUND ===');\nconsole.log(`Total unique staff names: ${staffNames.size}`);\nArray.from(staffNames).sort().forEach((name, index) => {\n    console.log(`\"${name}\" -> STF${(index + 1).toString().padStart(3, '0')}`);\n});\n\nconsole.log('\\n=== CLIENT NAMES FOUND ===');\nconsole.log(`Total unique client names: ${clientNames.size}`);\nArray.from(clientNames).sort().forEach((name, index) => {\n    console.log(`\"${name}\" -> CT${(index + 1).toString().padStart(3, '0')}`);\n});\n\n// Generate directory code for easy copy-paste\nconsole.log('\\n=== GENERATED DIRECTORY CODE ===');\nconsole.log('// Copy this into your NameCodeManager:');\nconsole.log('\\nconst staffData = [');\nArray.from(staffNames).sort().forEach((name, index) => {\n    console.log(`    { name: '${name}', code: 'STF${(index + 1).toString().padStart(3, '0')}', department: 'Clinical', role: 'Support Worker' },`);\n});\nconsole.log('];');\n\nconsole.log('\\nconst clientData = [');\nArray.from(clientNames).sort().forEach((name, index) => {\n    console.log(`    { name: '${name}', code: 'CT${(index + 1).toString().padStart(3, '0')}', program: 'General Care', riskLevel: 'medium' },`);\n});\nconsole.log('];');\n\n// Identify potential incomplete names\nconsole.log('\\n=== POTENTIAL INCOMPLETE NAMES ===');\nconst potentialIncomplete = [];\n\nArray.from(staffNames).forEach(name => {\n    if (name.split(' ').length < 2 || name.length < 5) {\n        potentialIncomplete.push(`STAFF: \"${name}\" - might be incomplete`);\n    }\n});\n\nArray.from(clientNames).forEach(name => {\n    if (name.split(' ').length < 2 || name.length < 5) {\n        potentialIncomplete.push(`CLIENT: \"${name}\" - might be incomplete`);\n    }\n});\n\nif (potentialIncomplete.length > 0) {\n    console.log('Names that might be incomplete:');\n    potentialIncomplete.forEach(name => console.log(`‚ö†Ô∏è ${name}`));\n}\n\nreturn [{\n    json: {\n        analysis: 'completed',\n        staffCount: staffNames.size,\n        clientCount: clientNames.size,\n        fieldCount: fieldNames.size,\n        potentialIssues: potentialIncomplete.length\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        272,
        80
      ],
      "id": "6fbe946c-fd78-442a-93d1-6265252aa378",
      "name": "Extracts Form Response Sheet"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        480,
        80
      ],
      "id": "0a8da605-b335-4657-8e10-b03d9d3860d7",
      "name": "Test Sheet for Columns Extraction"
    },
    {
      "parameters": {
        "jsCode": "const originalFormData = $items(\"Get row(s) in sheet2\")[0].json;\n\nreturn [{\n    json: {\n        // When and What\n        Timestamp: new Date().toISOString(),\n        Action: \"Shift Report Generated\",\n        Status: \"Success\",\n        \n        // Who and Where  \n        Participant_Name: originalFormData['Participant Full Name'] || 'Unknown',\n        Staff_Name: originalFormData['Staff Full Name'] || 'Unknown',\n        Shift_Location: originalFormData['Shift Location'] || 'Unknown',\n        \n        // When (Shift Details)\n        Shift_Date: originalFormData['Sign In Date & Time'] || 'Not recorded',\n        Report_Date: new Date().toLocaleDateString(),\n        \n        // File Info\n        Report_Type: \"Shift Report\",\n        File_Saved: \"Yes - Google Drive\",\n        \n        // Context\n        Had_Incident: \"No\",\n        Notes: \"Regular shift documentation completed\"\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2496,
        768
      ],
      "id": "988ae1f7-dbde-4778-85d0-823c4f262e0a",
      "name": "Log Shift Report"
    },
    {
      "parameters": {
        "jsCode": "const originalFormData = $items(\"Get row(s) in sheet2\")[0].json;\n\nreturn [{\n    json: {\n        // When and What\n        Timestamp: new Date().toISOString(),\n        Action: \"Incident Report Generated\",\n        Status: \"Success\",\n        \n        // Who and Where\n        Participant_Name: originalFormData['Participant Full Name'] || 'Unknown',\n        Staff_Name: originalFormData['Staff Full Name'] || 'Unknown', \n        Shift_Location: originalFormData['Shift Location'] || 'Unknown',\n        \n        // When (Incident Details)\n        Shift_Date: originalFormData['Sign In Date & Time'] || 'Not recorded',\n        Incident_Date: originalFormData['Incident Date and Time'] || 'Not specified',\n        Report_Date: new Date().toLocaleDateString(),\n        \n        // File Info\n        Report_Type: \"Incident Report\",\n        File_Saved: \"Yes - Google Drive\",\n        \n        // Context\n        Had_Incident: \"Yes\",\n        Incident_Location: originalFormData['Location of Incident'] || 'Not specified',\n        Notes: \"Critical incident documented and saved\"\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2512,
        1008
      ],
      "id": "83b21f57-bceb-47ce-9487-5fc95aafe94f",
      "name": "Log Incident Report"
    },
    {
      "parameters": {
        "jsCode": "const originalFormData = $items(\"Get row(s) in sheet2\")[0].json;\n\nreturn [{\n    json: {\n        // When and What\n        Timestamp: new Date().toISOString(),\n        Action: \"Incident Email Sent\",\n        Status: \"Success\",\n        \n        // Who and Where\n        Participant_Name: originalFormData['Participant Full Name'] || 'Unknown',\n        Staff_Name: originalFormData['Staff Full Name'] || 'Unknown',\n        Shift_Location: originalFormData['Shift Location'] || 'Unknown',\n        \n        // When\n        Shift_Date: originalFormData['Sign In Date & Time'] || 'Not recorded',\n        Email_Date: new Date().toLocaleDateString(),\n        Report_Date: new Date().toLocaleDateString(),\n        \n        // Email Info\n        Report_Type: \"Incident Email Notification\",\n        File_Saved: \"N/A\",\n        Email_Recipient: \"Management\",\n        \n        // Context\n        Had_Incident: \"Yes\",\n        Notes: \"Urgent incident notification sent to management\"\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2672,
        1216
      ],
      "id": "2f133443-55ed-410b-9bb9-68bb8a009d4f",
      "name": "Log Incident Email"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2816,
        1008
      ],
      "id": "db77db19-a427-4cb9-acdf-46ec0d245e42",
      "name": "Logging Incident Report"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2816,
        1216
      ],
      "id": "a44badcf-8a9e-4e01-bb74-214b115f09af",
      "name": "Logging Email"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2800,
        768
      ],
      "id": "96861155-ed75-49e4-9713-ecd8a39cbe6d",
      "name": "Logging Daily Shift Report"
    },
    {
      "parameters": {
        "content": "## Conditional logging and routing",
        "height": 592,
        "width": 1232,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        1440
      ],
      "id": "930c5c64-3fcb-4ca4-b592-367fa4ba94ed",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Check and Format of Report\n",
        "height": 560,
        "width": 656,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        656
      ],
      "id": "34a851a5-b3ce-40c2-9060-c66a30a41d19",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Create PDF",
        "height": 528
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1520,
        672
      ],
      "id": "57bb7dd7-69f1-4a16-a62e-cfff0baac25b",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Folder ID and save into Drive",
        "height": 576,
        "width": 496,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1888,
        656
      ],
      "id": "891c69c8-4fb3-4897-b63d-975038f417ae",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Logs for Shift, Incident & Email",
        "height": 1216,
        "width": 496,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2432,
        624
      ],
      "id": "05aae13e-4fa0-4519-9313-e8df60fe0e63",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Debugging nodes\n",
        "height": 256,
        "width": 1424
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "163fc8c4-36d6-4afc-be35-1609aebd7f56",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "# Daily Shift & Incident Report Generator and Conditional Logger",
        "height": 1600,
        "width": 3248,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -80,
        480
      ],
      "id": "28a4994a-6efe-4bd0-b346-3903f5391029",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "jsCode": "// Get the report data from Shift Report node\nconst reportData = $input.item.json;\n\n// Get the original form data from the Test data node\nconst formData = $items(\"Get row(s) in sheet2\")[0].json;\n\n\n// Helper function to check if a field has meaningful data\nconst hasValue = (fieldName) => {\n    const value = formData[fieldName];\n    return value && value.trim() !== '' && \n           !value.toLowerCase().includes('not recorded') && \n           !value.toLowerCase().includes('not specified') &&\n           !value.toLowerCase().includes('none');\n};\n\n// Check which sections have data\nconst hasNutrition = hasValue('Meal Details') || hasValue('Hydration Intake') || hasValue('Did the participant consume adequate food or fluids?');\nconst hasMedication = hasValue('Were any medications administered during this shift?') || hasValue('list all medications administered (if applicable)');\nconst hasActivities = hasValue('Daily Activities (including Personal Care)') || hasValue('Activities') || hasValue('Other Engagements');\nconst hasBehavioral = hasValue('Behavioural Notes / Mood Observations') || hasValue('Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?');\nconst hasHandover = hasValue('Handover from previous shift') || hasValue('Handover to next shift');\nconst hasSwallowing = hasValue('Did the participant have any difficulty chewing or swallowing during meals or with fluids?');\nconst hasChoking = hasValue('Were there any signs of choking, coughing, or discomfort while eating or drinking?');\nconst hasPRN = hasValue('PRN1 Medication name') || hasValue('PRN2 Medication name') || hasValue('PRN3 Medication name');\nconst hasCommunity = hasValue('Did the participant participate in any community activities today?');\nconst hasIRC = hasValue('Did you face any issues, risks, or challenges during the shift?');\nconst hasAppointments = hasValue('Were there any appointments during this shift?');\nconst hasShiftEvaluation = hasValue('How did your shift go today?') || hasValue('Did anything go particularly well during your shift?');\nconst hasStaffConcerns = hasValue('Did you experience any concerns or issues during your shift that you\\'d like to report?');\n\n// Check if incident occurred\nconst hasIncident = formData['Did any incidents occur during this shift?']?.toLowerCase().includes('yes') ||\n                   formData['Incident Date and Time'] ||\n                   formData['Location of Incident'];\n\nconst htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n            line-height: 1.6; \n            color: #333; \n            background: #f8f9fa;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 900px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            overflow: hidden;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 35px;\n            text-align: center;\n        }\n        \n        .header h1 {\n            font-size: 30px;\n            font-weight: 600;\n            margin-bottom: 10px;\n            letter-spacing: 1px;\n        }\n        \n        .header .subtitle {\n            font-size: 16px;\n            opacity: 0.95;\n            margin-top: 5px;\n        }\n        \n        .content {\n            padding: 30px;\n        }\n        \n        .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n        \n        .info-card {\n            background: #f8f9fa;\n            border-radius: 8px;\n            padding: 20px;\n            border-left: 4px solid #667eea;\n        }\n        \n        .info-card h3 {\n            color: #667eea;\n            font-size: 13px;\n            font-weight: 600;\n            text-transform: uppercase;\n            margin-bottom: 8px;\n            letter-spacing: 1px;\n        }\n        \n        .info-card p {\n            font-size: 16px;\n            font-weight: 500;\n            color: #2c3e50;\n        }\n        \n        .section {\n            margin-bottom: 25px;\n            border-radius: 8px;\n            overflow: hidden;\n            border: 1px solid #e9ecef;\n        }\n        \n        .section-header {\n            background: #495057;\n            color: white;\n            padding: 15px 20px;\n            font-weight: 600;\n            font-size: 15px;\n            letter-spacing: 0.5px;\n        }\n        \n        .section-content {\n            padding: 20px;\n            background: white;\n        }\n        \n        .field-row {\n            margin-bottom: 15px;\n            padding-bottom: 15px;\n            border-bottom: 1px solid #f1f3f4;\n        }\n        \n        .field-row:last-child {\n            border-bottom: none;\n            margin-bottom: 0;\n            padding-bottom: 0;\n        }\n        \n        .field-label {\n            font-weight: 600;\n            color: #495057;\n            font-size: 13px;\n            margin-bottom: 5px;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n        \n        .field-value {\n            color: #2c3e50;\n            font-size: 14px;\n            line-height: 1.5;\n            padding: 8px;\n            background: #f8f9fa;\n            border-radius: 4px;\n        }\n        \n        .prn-item {\n            background: #fff5f5;\n            border: 1px solid #dc3545;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 15px;\n        }\n        \n        .prn-header {\n            color: #dc3545;\n            font-weight: 600;\n            margin-bottom: 10px;\n        }\n        \n        .incident-alert {\n            background: #fff3cd;\n            border: 2px solid #ffc107;\n            border-radius: 8px;\n            padding: 20px;\n            margin: 20px 0;\n            text-align: center;\n        }\n        \n        .incident-alert h4 {\n            color: #856404;\n            font-size: 18px;\n            margin-bottom: 10px;\n        }\n        \n        .warning-box {\n            background: #f8d7da;\n            border: 1px solid #f5c6cb;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 15px;\n            color: #721c24;\n        }\n        \n        .success-box {\n            background: #d4edda;\n            border: 1px solid #c3e6cb;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 15px;\n            color: #155724;\n        }\n        \n        .footer {\n            background: #f8f9fa;\n            padding: 20px;\n            text-align: center;\n            font-size: 12px;\n            color: #6c757d;\n            border-top: 1px solid #e9ecef;\n        }\n        \n        .report-id {\n            background: #e3f2fd;\n            color: #1565c0;\n            padding: 8px 16px;\n            border-radius: 20px;\n            display: inline-block;\n            font-family: monospace;\n            font-size: 12px;\n            margin-top: 10px;\n        }\n        \n        .status-badge {\n            background: #d4edda;\n            color: #155724;\n            padding: 5px 12px;\n            border-radius: 15px;\n            font-size: 12px;\n            font-weight: 600;\n            display: inline-block;\n        }\n        \n        @media print {\n            body { padding: 0; }\n            .container { box-shadow: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>COMPREHENSIVE SHIFT REPORT</h1>\n            <div class=\"subtitle\">Complete Care Documentation</div>\n        </div>\n        \n        <div class=\"content\">\n            <!-- Client and Staff Information -->\n            <div class=\"info-grid\">\n                <div class=\"info-card\">\n                    <h3>Client</h3>\n                    <p>${formData['Participant Full Name'] || 'Not specified'}</p>\n                </div>\n                <div class=\"info-card\">\n                    <h3>Staff Member</h3>\n                    <p>${formData['Staff Full Name'] || 'Not specified'}</p>\n                </div>\n            </div>\n            \n            <!-- Basic Shift Information -->\n            <div class=\"section\">\n                <div class=\"section-header\">üìã BASIC SHIFT INFORMATION</div>\n                <div class=\"section-content\">\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Report Date</div>\n                        <div class=\"field-value\">${new Date().toLocaleDateString()}</div>\n                    </div>\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Location</div>\n                        <div class=\"field-value\">${formData['Shift Location'] || 'Not specified'}</div>\n                    </div>\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Shift Period</div>\n                        <div class=\"field-value\">\n                            From: ${formData['Sign In Date & Time'] || 'Not recorded'}<br>\n                            To: ${formData['Sign Out Date & Time'] || 'Not recorded'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Handover Information -->\n            ${hasHandover ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üîÑ HANDOVER INFORMATION</div>\n                <div class=\"section-content\">\n                    ${hasValue('Handover from previous shift') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">From Previous Shift</div>\n                        <div class=\"field-value\">${formData['Handover from previous shift']}</div>\n                    </div>` : ''}\n                    ${hasValue('Handover to next shift') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">To Next Shift</div>\n                        <div class=\"field-value\">${formData['Handover to next shift']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Daily Activities -->\n            ${hasActivities ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üèÉ DAILY ACTIVITIES</div>\n                <div class=\"section-content\">\n                    ${hasValue('Daily Activities (including Personal Care)') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Personal Care</div>\n                        <div class=\"field-value\">${formData['Daily Activities (including Personal Care)']}</div>\n                    </div>` : ''}\n                    ${hasValue('Activities') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Activities</div>\n                        <div class=\"field-value\">${formData['Activities']}</div>\n                    </div>` : ''}\n                    ${hasValue('Other Engagements') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Other Engagements</div>\n                        <div class=\"field-value\">${formData['Other Engagements']}</div>\n                    </div>` : ''}\n                    ${hasValue('Family and Social Contacts (Phone/Video Calls)') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Family/Social Contacts</div>\n                        <div class=\"field-value\">${formData['Family and Social Contacts (Phone/Video Calls)']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Community Participation -->\n            ${hasCommunity ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üë• COMMUNITY PARTICIPATION</div>\n                <div class=\"section-content\">\n                    ${formData['Did the participant participate in any community activities today?']?.toLowerCase().includes('no') ? `\n                    <div class=\"warning-box\">\n                        <strong>‚ö†Ô∏è No Community Participation Today</strong>\n                    </div>\n                    ${hasValue('Why did the participant not attend the community activity today?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Reason for Non-Attendance</div>\n                        <div class=\"field-value\">${formData['Why did the participant not attend the community activity today?']}</div>\n                    </div>` : ''}\n                    ${hasValue('How did the participant respond when the activity was offered?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Participant Response</div>\n                        <div class=\"field-value\">${formData['How did the participant respond when the activity was offered?']}</div>\n                    </div>` : ''}\n                    ${hasValue('What steps or strategies did you take to encourage or motivate participation?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Encouragement Strategies</div>\n                        <div class=\"field-value\">${formData['What steps or strategies did you take to encourage or motivate participation?']}</div>\n                    </div>` : ''}\n                    ${hasValue('What could be done differently next time to support engagement?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Future Recommendations</div>\n                        <div class=\"field-value\">${formData['What could be done differently next time to support engagement?']}</div>\n                    </div>` : ''}\n                    ` : `\n                    <div class=\"success-box\">\n                        <strong>‚úì Participated in Community Activities</strong>\n                    </div>\n                    `}\n                </div>\n            </div>` : ''}\n            \n            <!-- Nutrition & Hydration -->\n            ${hasNutrition ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üçΩÔ∏è NUTRITION & HYDRATION</div>\n                <div class=\"section-content\">\n                    ${hasValue('Meal Details') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Meal Details</div>\n                        <div class=\"field-value\">${formData['Meal Details']}</div>\n                    </div>` : ''}\n                    ${hasValue('Hydration Intake') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Hydration Intake</div>\n                        <div class=\"field-value\">${formData['Hydration Intake']}</div>\n                    </div>` : ''}\n                    ${hasValue('Did the participant consume adequate food or fluids?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Adequate Intake Assessment</div>\n                        <div class=\"field-value\">${formData['Did the participant consume adequate food or fluids?']}</div>\n                    </div>` : ''}\n                    ${formData['Did the participant consume adequate food or fluids?']?.toLowerCase().includes('no') && \n                      hasValue('If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?') ? `\n                    <div class=\"warning-box\">\n                        <strong>‚ö†Ô∏è Inadequate Food/Fluid Intake</strong>\n                        <div style=\"margin-top: 10px;\">\n                            <strong>Reason & Actions:</strong> ${formData['If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?']}\n                        </div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Swallowing & Choking Issues -->\n            ${(hasSwallowing || hasChoking) ? `\n            <div class=\"section\">\n                <div class=\"section-header\">‚ö†Ô∏è SWALLOWING & SAFETY CONCERNS</div>\n                <div class=\"section-content\">\n                    ${hasSwallowing && formData['Did the participant have any difficulty chewing or swallowing during meals or with fluids?']?.toLowerCase().includes('yes') ? `\n                    <div class=\"warning-box\">\n                        <strong>Swallowing Difficulties Reported</strong>\n                        <div style=\"margin-top: 10px;\">\n                            ${formData['Explain the difficulty in chewing or swallowing experienced during meals and with fluids, and what actions were taken by staff.'] || ''}\n                        </div>\n                    </div>` : ''}\n                    ${hasChoking && formData['Were there any signs of choking, coughing, or discomfort while eating or drinking?']?.toLowerCase().includes('yes') ? `\n                    <div class=\"warning-box\">\n                        <strong>Choking/Coughing Signs Observed</strong>\n                        <div style=\"margin-top: 10px;\">\n                            ${formData['Were there any signs of choking, coughing, or discomfort while eating or drinking? If yes, explain the possible cause and describe the actions taken by staff.'] || ''}\n                        </div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Medication Administration -->\n            ${hasMedication ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üíä MEDICATION ADMINISTRATION</div>\n                <div class=\"section-content\">\n                    ${hasValue('Were any medications administered during this shift?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Medications Given</div>\n                        <div class=\"field-value\">${formData['Were any medications administered during this shift?']}</div>\n                    </div>` : ''}\n                    ${hasValue('list all medications administered (if applicable)') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Medication List</div>\n                        <div class=\"field-value\">${formData['list all medications administered (if applicable)']}</div>\n                    </div>` : ''}\n                    ${hasValue('Medication time') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Administration Times</div>\n                        <div class=\"field-value\">${formData['Medication time']}</div>\n                    </div>` : ''}\n                    ${hasValue('Medication source') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Medication Source</div>\n                        <div class=\"field-value\">${formData['Medication source']}</div>\n                    </div>` : ''}\n                    ${hasValue('Method of administration') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Administration Method</div>\n                        <div class=\"field-value\">${formData['Method of administration']}</div>\n                    </div>` : ''}\n                    ${hasValue('Any issues or observations during administration?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Issues/Observations</div>\n                        <div class=\"field-value\">${formData['Any issues or observations during administration?']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- PRN Medications -->\n            ${hasPRN ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üíä PRN MEDICATIONS</div>\n                <div class=\"section-content\">\n                    ${formData['PRN1 Medication name'] ? `\n                    <div class=\"prn-item\">\n                        <div class=\"prn-header\">PRN #1</div>\n                        <strong>Medication:</strong> ${formData['PRN1 Medication name']}<br>\n                        <strong>Dose:</strong> ${formData['PRN1 Dose'] || 'Not specified'}<br>\n                        <strong>Time:</strong> ${formData['PRN1 Time given'] || 'Not specified'}<br>\n                        <strong>Reason:</strong> ${formData['PRN1 Reason for administration'] || 'Not specified'}<br>\n                        <strong>Outcome:</strong> ${formData['PRN1 Effect/Outcome observed'] || 'Not specified'}\n                    </div>` : ''}\n                    ${formData['PRN2 Medication name'] ? `\n                    <div class=\"prn-item\">\n                        <div class=\"prn-header\">PRN #2</div>\n                        <strong>Medication:</strong> ${formData['PRN2 Medication name']}<br>\n                        <strong>Dose:</strong> ${formData['PRN2 Dose'] || 'Not specified'}<br>\n                        <strong>Time:</strong> ${formData['PRN2 Time given'] || 'Not specified'}<br>\n                        <strong>Reason:</strong> ${formData['PRN2 Reason for administration'] || 'Not specified'}<br>\n                        <strong>Outcome:</strong> ${formData['PRN2 Effect/Outcome observed'] || 'Not specified'}\n                    </div>` : ''}\n                    ${formData['PRN3 Medication name'] ? `\n                    <div class=\"prn-item\">\n                        <div class=\"prn-header\">PRN #3</div>\n                        <strong>Medication:</strong> ${formData['PRN3 Medication name']}<br>\n                        <strong>Dose:</strong> ${formData['PRN3 Dose'] || 'Not specified'}<br>\n                        <strong>Time:</strong> ${formData['PRN3 Time given'] || 'Not specified'}<br>\n                        <strong>Reason:</strong> ${formData['PRN3 Reason for administration'] || 'Not specified'}<br>\n                        <strong>Outcome:</strong> ${formData['PRN3 Effect/Outcome observed'] || 'Not specified'}\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Appointments -->\n            ${hasAppointments && formData['Were there any appointments during this shift?']?.toLowerCase().includes('yes') ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üìÖ APPOINTMENTS</div>\n                <div class=\"section-content\">\n                    ${hasValue('Type of Appointment') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Appointment Type</div>\n                        <div class=\"field-value\">${formData['Type of Appointment']}</div>\n                    </div>` : ''}\n                    ${hasValue('Purpose of the Appointment') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Purpose</div>\n                        <div class=\"field-value\">${formData['Purpose of the Appointment']}</div>\n                    </div>` : ''}\n                    ${hasValue('Name of Clinic or Service') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Clinic/Service</div>\n                        <div class=\"field-value\">${formData['Name of Clinic or Service']}</div>\n                    </div>` : ''}\n                    ${hasValue('Name of the Professional Seen') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Professional Seen</div>\n                        <div class=\"field-value\">${formData['Name of the Professional Seen']}</div>\n                    </div>` : ''}\n                    ${hasValue('Brief Summary of the Appointment') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Appointment Summary</div>\n                        <div class=\"field-value\">${formData['Brief Summary of the Appointment']}</div>\n                    </div>` : ''}\n                    ${hasValue('Follow Up Actions Required') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Follow-up Required</div>\n                        <div class=\"field-value\">${formData['Follow Up Actions Required']}</div>\n                    </div>` : ''}\n                    ${hasValue('Next Appointment Date (if scheduled)') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Next Appointment</div>\n                        <div class=\"field-value\">${formData['Next Appointment Date (if scheduled)']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Behavioral Observations -->\n            ${hasBehavioral ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üß† BEHAVIORAL OBSERVATIONS</div>\n                <div class=\"section-content\">\n                    ${hasValue('Behavioural Notes / Mood Observations') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Mood/Behavior Notes</div>\n                        <div class=\"field-value\">${formData['Behavioural Notes / Mood Observations']}</div>\n                    </div>` : ''}\n                    ${hasValue('Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Health/Safety Concerns</div>\n                        <div class=\"field-value\">${formData['Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Issues, Risks, Challenges -->\n            ${hasIRC && formData['Did you face any issues, risks, or challenges during the shift?']?.toLowerCase().includes('yes') ? `\n            <div class=\"section\">\n                <div class=\"section-header\">‚ö†Ô∏è ISSUES, RISKS & CHALLENGES</div>\n                <div class=\"section-content\">\n                    ${formData['Type of IRC (Issue/Risk/Challenge) 1'] ? `\n                    <div class=\"warning-box\">\n                        <strong>${formData['Type of IRC (Issue/Risk/Challenge) 1']}</strong>\n                        <div style=\"margin-top: 10px;\">\n                            ${formData['Describe the IRC ( issues, risks, or challenges) 1'] || ''}\n                        </div>\n                    </div>` : ''}\n                    ${formData['Type of IRC (Issue/Risk/Challenge) 2'] ? `\n                    <div class=\"warning-box\">\n                        <strong>${formData['Type of IRC (Issue/Risk/Challenge) 2']}</strong>\n                        <div style=\"margin-top: 10px;\">\n                            ${formData['Describe the IRC ( issues, risks, or challenges) 2'] || ''}\n                        </div>\n                    </div>` : ''}\n                    ${formData['Type of IRC (Issue/Risk/Challenge) 3'] ? `\n                    <div class=\"warning-box\">\n                        <strong>${formData['Type of IRC (Issue/Risk/Challenge) 3']}</strong>\n                        <div style=\"margin-top: 10px;\">\n                            ${formData['Describe the IRC ( issues, risks, or challenges) 3'] || ''}\n                        </div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Incident Alert (if applicable) -->\n            ${hasIncident ? \n                '<div class=\"incident-alert\"><h4>‚ö†Ô∏è INCIDENT REPORTED DURING SHIFT</h4><p>A separate detailed incident report has been generated and sent to management.</p></div>' \n                : ''}\n            \n            <!-- Shift Evaluation -->\n            ${hasShiftEvaluation ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üìä SHIFT EVALUATION</div>\n                <div class=\"section-content\">\n                    ${hasValue('How did your shift go today?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Shift Rating</div>\n                        <div class=\"field-value\">${formData['How did your shift go today?']}</div>\n                    </div>` : ''}\n                    ${formData['How did your shift go today?']?.toLowerCase().includes('difficult') && \n                      hasValue('If you rated the shift as Difficult or Very Difficult, please explain why.') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Difficulty Explanation</div>\n                        <div class=\"field-value\">${formData['If you rated the shift as Difficult or Very Difficult, please explain why.']}</div>\n                    </div>` : ''}\n                    ${hasValue('Did anything go particularly well during your shift?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Positive Highlights</div>\n                        <div class=\"field-value\">${formData['Did anything go particularly well during your shift?']}</div>\n                    </div>` : ''}\n                    ${hasValue('Did you need any additional support, resources, or information during your shift?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Support Needed</div>\n                        <div class=\"field-value\">${formData['Did you need any additional support, resources, or information during your shift?']}</div>\n                    </div>` : ''}\n                    ${hasValue('Do you have any additional comments or suggestions for improving future shifts, teamwork, or participant support?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Additional Comments</div>\n                        <div class=\"field-value\">${formData['Do you have any additional comments or suggestions for improving future shifts, teamwork, or participant support?']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Staff Concerns & Management Notifications -->\n            ${hasStaffConcerns && formData['Did you experience any concerns or issues during your shift that you\\'d like to report?']?.toLowerCase().includes('yes') ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üì¢ STAFF CONCERNS & MANAGEMENT NOTIFICATIONS</div>\n                <div class=\"section-content\">\n                    ${hasValue('Would you like to provide more details about any concerns, issues, or complaints raised during this shift? If yes, please describe what happened and any actions taken.') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Concern Details</div>\n                        <div class=\"field-value\">${formData['Would you like to provide more details about any concerns, issues, or complaints raised during this shift? If yes, please describe what happened and any actions taken.']}</div>\n                    </div>` : ''}\n                    ${hasValue('How are you feeling physically and emotionally after this shift?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Staff Wellbeing</div>\n                        <div class=\"field-value\">${formData['How are you feeling physically and emotionally after this shift?']}</div>\n                    </div>` : ''}\n                    ${hasValue('Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?') ? `\n                    <div class=\"warning-box\">\n                        <strong>Management Attention Required:</strong>\n                        <div style=\"margin-top: 10px;\">\n                            ${formData['Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?']}\n                        </div>\n                    </div>` : ''}\n                    ${formData['Would you like someone to follow up with you?']?.toLowerCase().includes('yes') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Follow-up Requested</div>\n                        <div class=\"field-value\">Yes - Staff has requested follow-up</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Training Needs -->\n            ${formData['Do you feel you need additional training or support?']?.toLowerCase().includes('yes') ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üìö TRAINING NEEDS IDENTIFIED</div>\n                <div class=\"section-content\">\n                    ${hasValue('Which areas do you feel you need training in?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Training Areas</div>\n                        <div class=\"field-value\">${formData['Which areas do you feel you need training in?']}</div>\n                    </div>` : ''}\n                    ${hasValue('What type of support would help you most?') ? `\n                    <div class=\"field-row\">\n                        <div class=\"field-label\">Support Type</div>\n                        <div class=\"field-value\">${formData['What type of support would help you most?']}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n        </div>\n        \n        <div class=\"footer\">\n            <div class=\"status-badge\">COMPLETED</div>\n            <div class=\"report-id\">Report ID: SR-${Date.now()}</div>\n            <p style=\"margin-top: 15px;\">Generated on ${new Date().toLocaleString()}</p>\n            <p>Completed by: ${formData['Staff Full Name'] || 'Unknown'}</p>\n            ${hasIncident ? '<p style=\"color: #dc3545; font-weight: 600; margin-top: 10px;\">‚ö†Ô∏è NOTE: Separate incident report generated and emailed to management.</p>' : ''}\n        </div>\n    </div>\n</body>\n</html>`;\n\nconst requestBody = {\n    source: htmlContent,\n    format: \"A4\",\n    margin: \"0.5cm\",\n    landscape: false\n};\n\nreturn [{\n    json: {\n        ...reportData,\n        pdfRequestBody: requestBody\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1536,
        80
      ],
      "id": "9337eeb1-4398-439f-b343-b75667237ac0",
      "name": "Stylish Shift Report Structure"
    },
    {
      "parameters": {
        "jsCode": "// Get the report data and form data\nconst reportData = $input.item.json;\nconst formData = $items(\"Test data\")[0].json;\n\n\n// Helper function for checking values\nconst hasValue = (fieldName) => {\n    const value = formData[fieldName];\n    return value && value.trim() !== '' && \n           !value.toLowerCase().includes('not specified') &&\n           !value.toLowerCase().includes('not recorded');\n};\n\nconst htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n            line-height: 1.6; \n            color: #333; \n            background: #fff5f5;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 900px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.15);\n            overflow: hidden;\n            border: 3px solid #dc3545;\n        }\n        \n        .urgent-banner {\n            background: repeating-linear-gradient(\n                45deg,\n                #dc3545,\n                #dc3545 10px,\n                #c82333 10px,\n                #c82333 20px\n            );\n            color: white;\n            text-align: center;\n            padding: 12px;\n            font-weight: bold;\n            font-size: 15px;\n            letter-spacing: 2px;\n            text-transform: uppercase;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);\n            color: white;\n            padding: 35px;\n            text-align: center;\n            position: relative;\n        }\n        \n        .header h1 {\n            font-size: 34px;\n            font-weight: 700;\n            margin-bottom: 15px;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n            letter-spacing: 1px;\n        }\n        \n        .header .subtitle {\n            font-size: 18px;\n            font-weight: 600;\n            background: rgba(255,255,255,0.2);\n            padding: 8px 20px;\n            border-radius: 20px;\n            display: inline-block;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .priority-bar {\n            background: #fff3cd;\n            border-left: 8px solid #ffc107;\n            padding: 20px;\n            margin: 0;\n            text-align: center;\n            border-bottom: 2px solid #ffc107;\n        }\n        \n        .priority-text {\n            color: #856404;\n            font-size: 19px;\n            font-weight: 700;\n            text-transform: uppercase;\n            letter-spacing: 2px;\n        }\n        \n        .content {\n            padding: 30px;\n        }\n        \n        .critical-info {\n            background: linear-gradient(45deg, #fff5f5, #ffeaa7);\n            border: 2px solid #dc3545;\n            border-radius: 12px;\n            padding: 25px;\n            margin-bottom: 30px;\n            position: relative;\n        }\n        \n        .critical-info::before {\n            content: 'CRITICAL';\n            position: absolute;\n            top: -12px;\n            left: 20px;\n            background: #dc3545;\n            color: white;\n            padding: 5px 15px;\n            border-radius: 15px;\n            font-size: 12px;\n            font-weight: 700;\n            letter-spacing: 1px;\n        }\n        \n        .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin-top: 20px;\n        }\n        \n        .info-item {\n            background: white;\n            padding: 15px;\n            border-radius: 8px;\n            border-left: 4px solid #dc3545;\n        }\n        \n        .info-label {\n            font-size: 12px;\n            color: #dc3545;\n            font-weight: 600;\n            text-transform: uppercase;\n            margin-bottom: 5px;\n            letter-spacing: 1px;\n        }\n        \n        .info-value {\n            font-size: 16px;\n            font-weight: 600;\n            color: #2c3e50;\n        }\n        \n        .section {\n            margin-bottom: 25px;\n            border-radius: 10px;\n            overflow: hidden;\n            border: 2px solid #dc3545;\n            background: white;\n        }\n        \n        .section-header {\n            background: #dc3545;\n            color: white;\n            padding: 15px 20px;\n            font-weight: 700;\n            font-size: 16px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .section-content {\n            padding: 25px;\n        }\n        \n        .incident-field {\n            margin-bottom: 20px;\n            padding: 15px;\n            background: #f8f9fa;\n            border-radius: 8px;\n            border-left: 4px solid #dc3545;\n        }\n        \n        .incident-field:last-child {\n            margin-bottom: 0;\n        }\n        \n        .field-label {\n            font-weight: 700;\n            color: #dc3545;\n            font-size: 14px;\n            margin-bottom: 8px;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n        \n        .field-value {\n            color: #2c3e50;\n            font-size: 15px;\n            line-height: 1.6;\n            background: white;\n            padding: 12px;\n            border-radius: 6px;\n            border: 1px solid #e9ecef;\n        }\n        \n        .empty-value {\n            color: #999;\n            font-style: italic;\n            background: #f8f9fa;\n        }\n        \n        .warning-section {\n            background: #f8d7da;\n            border: 2px solid #dc3545;\n            border-radius: 8px;\n            padding: 20px;\n            margin: 20px 0;\n        }\n        \n        .warning-title {\n            color: #721c24;\n            font-weight: 700;\n            font-size: 16px;\n            margin-bottom: 10px;\n            text-transform: uppercase;\n        }\n        \n        .urgent-action {\n            background: linear-gradient(45deg, #dc3545, #c82333);\n            color: white;\n            padding: 25px;\n            margin: 30px 0;\n            text-align: center;\n            border-radius: 10px;\n            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);\n            animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n            0% { box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3); }\n            50% { box-shadow: 0 4px 25px rgba(220, 53, 69, 0.5); }\n            100% { box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3); }\n        }\n        \n        .urgent-action h3 {\n            font-size: 20px;\n            margin-bottom: 10px;\n            text-transform: uppercase;\n            letter-spacing: 2px;\n        }\n        \n        .urgent-action p {\n            font-size: 16px;\n            font-weight: 600;\n        }\n        \n        .timeline-section {\n            background: #f8f9fa;\n            border-radius: 8px;\n            padding: 20px;\n            margin: 20px 0;\n        }\n        \n        .timeline-item {\n            display: flex;\n            margin-bottom: 15px;\n            padding-bottom: 15px;\n            border-bottom: 1px solid #dee2e6;\n        }\n        \n        .timeline-item:last-child {\n            border-bottom: none;\n            margin-bottom: 0;\n            padding-bottom: 0;\n        }\n        \n        .timeline-label {\n            font-weight: 600;\n            color: #dc3545;\n            min-width: 120px;\n            margin-right: 20px;\n        }\n        \n        .timeline-value {\n            color: #495057;\n            flex: 1;\n        }\n        \n        .witness-list {\n            background: #fff5f5;\n            border: 1px solid #dc3545;\n            border-radius: 6px;\n            padding: 15px;\n            margin: 15px 0;\n        }\n        \n        .witness-header {\n            font-weight: 600;\n            color: #dc3545;\n            margin-bottom: 10px;\n        }\n        \n        .footer {\n            background: #dc3545;\n            color: white;\n            padding: 25px;\n            text-align: center;\n        }\n        \n        .report-id {\n            background: rgba(255,255,255,0.2);\n            padding: 10px 20px;\n            border-radius: 25px;\n            display: inline-block;\n            font-family: 'Courier New', monospace;\n            font-size: 14px;\n            margin-bottom: 15px;\n            font-weight: 600;\n            letter-spacing: 1px;\n        }\n        \n        .timestamp {\n            font-size: 13px;\n            opacity: 0.9;\n            margin: 5px 0;\n        }\n        \n        .confidential-notice {\n            background: rgba(255,255,255,0.1);\n            border: 2px solid rgba(255,255,255,0.3);\n            border-radius: 8px;\n            padding: 15px;\n            margin-top: 20px;\n        }\n        \n        .confidential-notice p {\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        @media print {\n            body { padding: 0; background: white; }\n            .container { box-shadow: none; border: 1px solid #dc3545; }\n            .urgent-action { animation: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"urgent-banner\">\n            üö® URGENT - IMMEDIATE ATTENTION REQUIRED üö®\n        </div>\n        \n        <div class=\"header\">\n            <h1>CRITICAL INCIDENT REPORT</h1>\n            <div class=\"subtitle\">PRIORITY LEVEL: CRITICAL</div>\n        </div>\n        \n        <div class=\"priority-bar\">\n            <div class=\"priority-text\">‚ö†Ô∏è IMMEDIATE MANAGEMENT REVIEW REQUIRED ‚ö†Ô∏è</div>\n        </div>\n        \n        <div class=\"content\">\n            <!-- Critical Personnel Information -->\n            <div class=\"critical-info\">\n                <h3 style=\"color: #dc3545; margin-bottom: 15px; font-size: 18px;\">PERSONNEL & LOCATION INFORMATION</h3>\n                <div class=\"info-grid\">\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">Client/Participant</div>\n                        <div class=\"info-value\">${formData['Participant Full Name'] || 'Unknown'}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">Staff Member</div>\n                        <div class=\"info-value\">${formData['Staff Full Name'] || 'Unknown'}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">Shift Location</div>\n                        <div class=\"info-value\">${formData['Shift Location'] || 'Not specified'}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">Report Generated</div>\n                        <div class=\"info-value\">${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Incident Details Section -->\n            <div class=\"section\">\n                <div class=\"section-header\">üö® INCIDENT DETAILS</div>\n                <div class=\"section-content\">\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Incident Confirmation</div>\n                        <div class=\"field-value ${!hasValue('Did any incidents occur during this shift?') ? 'empty-value' : ''}\">\n                            ${formData['Did any incidents occur during this shift?'] || 'Incident detected from field data'}\n                        </div>\n                    </div>\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Date & Time of Incident</div>\n                        <div class=\"field-value ${!hasValue('Incident Date and Time') ? 'empty-value' : ''}\">\n                            ${formData['Incident Date and Time'] || 'NOT SPECIFIED - CRITICAL INFORMATION MISSING'}\n                        </div>\n                    </div>\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Location of Incident</div>\n                        <div class=\"field-value ${!hasValue('Location of Incident') ? 'empty-value' : ''}\">\n                            ${formData['Location of Incident'] || 'NOT SPECIFIED - CRITICAL INFORMATION MISSING'}\n                        </div>\n                    </div>\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">People Involved</div>\n                        <div class=\"field-value ${!hasValue('People Involved') ? 'empty-value' : ''}\">\n                            ${formData['People Involved'] || 'NOT SPECIFIED - CRITICAL INFORMATION MISSING'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Incident Description Section -->\n            <div class=\"section\">\n                <div class=\"section-header\">üìù INCIDENT DESCRIPTION</div>\n                <div class=\"section-content\">\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">What Happened</div>\n                        <div class=\"field-value ${!hasValue('Describe What Happened') ? 'empty-value' : ''}\">\n                            ${formData['Describe What Happened'] || 'NO DESCRIPTION PROVIDED - CRITICAL INFORMATION MISSING'}\n                        </div>\n                    </div>\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Events Leading to Incident</div>\n                        <div class=\"field-value ${!hasValue('What led up to the incident?') ? 'empty-value' : ''}\">\n                            ${formData['What led up to the incident?'] || 'NOT SPECIFIED'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Response & Outcome Section -->\n            <div class=\"section\">\n                <div class=\"section-header\">‚ö° RESPONSE & OUTCOME</div>\n                <div class=\"section-content\">\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Immediate Actions Taken</div>\n                        <div class=\"field-value ${!hasValue('Actions Taken / Response') ? 'empty-value' : ''}\">\n                            ${formData['Actions Taken / Response'] || 'NO ACTIONS RECORDED - CRITICAL INFORMATION MISSING'}\n                        </div>\n                    </div>\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Incident Outcome</div>\n                        <div class=\"field-value ${!hasValue('Outcome of the Incident') ? 'empty-value' : ''}\">\n                            ${formData['Outcome of the Incident'] || 'OUTCOME NOT RECORDED'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Reporting & Follow-up Section -->\n            <div class=\"section\">\n                <div class=\"section-header\">üìã REPORTING & FOLLOW-UP</div>\n                <div class=\"section-content\">\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Reported To</div>\n                        <div class=\"field-value ${!hasValue('Was it reported? If yes, to whom and how?') ? 'empty-value' : ''}\">\n                            ${formData['Was it reported? If yes, to whom and how?'] || 'REPORTING STATUS UNKNOWN - REQUIRES CLARIFICATION'}\n                        </div>\n                    </div>\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Follow-up Recommendations</div>\n                        <div class=\"field-value ${!hasValue('Follow-up / Recommendations') ? 'empty-value' : ''}\">\n                            ${formData['Follow-up / Recommendations'] || 'NO RECOMMENDATIONS PROVIDED'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Related Shift Information -->\n            <div class=\"section\">\n                <div class=\"section-header\">üìä RELATED SHIFT INFORMATION</div>\n                <div class=\"section-content\">\n                    <div class=\"timeline-section\">\n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-label\">Shift Start:</div>\n                            <div class=\"timeline-value\">${formData['Sign In Date & Time'] || 'Not recorded'}</div>\n                        </div>\n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-label\">Shift End:</div>\n                            <div class=\"timeline-value\">${formData['Sign Out Date & Time'] || 'Not recorded'}</div>\n                        </div>\n                        <div class=\"timeline-item\">\n                            <div class=\"timeline-label\">Incident Time:</div>\n                            <div class=\"timeline-value\">${formData['Incident Date and Time'] || 'Not specified'}</div>\n                        </div>\n                    </div>\n                    \n                    ${hasValue('Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?') ? `\n                    <div class=\"warning-section\">\n                        <div class=\"warning-title\">Health/Safety Concerns Noted</div>\n                        <p>${formData['Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?']}</p>\n                    </div>` : ''}\n                    \n                    ${hasValue('Behavioural Notes / Mood Observations') ? `\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Behavioral Context</div>\n                        <div class=\"field-value\">${formData['Behavioural Notes / Mood Observations']}</div>\n                    </div>` : ''}\n                </div>\n            </div>\n            \n            <!-- Staff Assessment Section -->\n            ${(hasValue('How did your shift go today?') || hasValue('Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?')) ? `\n            <div class=\"section\">\n                <div class=\"section-header\">üë§ STAFF ASSESSMENT & NOTES</div>\n                <div class=\"section-content\">\n                    ${hasValue('How did your shift go today?') ? `\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Overall Shift Assessment</div>\n                        <div class=\"field-value\">${formData['How did your shift go today?']}</div>\n                    </div>` : ''}\n                    ${hasValue('Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?') ? `\n                    <div class=\"warning-section\">\n                        <div class=\"warning-title\">Management Attention Required</div>\n                        <p>${formData['Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?']}</p>\n                    </div>` : ''}\n                    ${formData['Would you like someone to follow up with you?']?.toLowerCase().includes('yes') ? `\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">Follow-up Requested</div>\n                        <div class=\"field-value\">‚úì Yes - Staff has requested management follow-up</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Additional Context (if any IRC reported) -->\n            ${formData['Did you face any issues, risks, or challenges during the shift?']?.toLowerCase().includes('yes') ? `\n            <div class=\"section\">\n                <div class=\"section-header\">‚ö†Ô∏è ADDITIONAL ISSUES/RISKS/CHALLENGES</div>\n                <div class=\"section-content\">\n                    ${formData['Type of IRC (Issue/Risk/Challenge) 1'] ? `\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">${formData['Type of IRC (Issue/Risk/Challenge) 1']} #1</div>\n                        <div class=\"field-value\">${formData['Describe the IRC ( issues, risks, or challenges) 1'] || 'Not described'}</div>\n                    </div>` : ''}\n                    ${formData['Type of IRC (Issue/Risk/Challenge) 2'] ? `\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">${formData['Type of IRC (Issue/Risk/Challenge) 2']} #2</div>\n                        <div class=\"field-value\">${formData['Describe the IRC ( issues, risks, or challenges) 2'] || 'Not described'}</div>\n                    </div>` : ''}\n                    ${formData['Type of IRC (Issue/Risk/Challenge) 3'] ? `\n                    <div class=\"incident-field\">\n                        <div class=\"field-label\">${formData['Type of IRC (Issue/Risk/Challenge) 3']} #3</div>\n                        <div class=\"field-value\">${formData['Describe the IRC ( issues, risks, or challenges) 3'] || 'Not described'}</div>\n                    </div>` : ''}\n                </div>\n            </div>` : ''}\n            \n            <div class=\"urgent-action\">\n                <h3>üö® URGENT ACTION REQUIRED üö®</h3>\n                <p>MANAGEMENT REVIEW NEEDED IMMEDIATELY</p>\n                <p style=\"font-size: 14px; margin-top: 10px;\">This incident requires immediate attention and follow-up action</p>\n            </div>\n        </div>\n        \n        <div class=\"footer\">\n            <div class=\"report-id\">REPORT ID: INC-${Date.now()}</div>\n            <div class=\"timestamp\">Generated: ${new Date().toLocaleString()}</div>\n            <div class=\"timestamp\">Report Type: Critical Incident Documentation</div>\n            <div class=\"timestamp\">Submitted By: ${formData['Staff Full Name'] || 'Unknown'}</div>\n            \n            <div class=\"confidential-notice\">\n                <p>‚ö†Ô∏è CONFIDENTIAL INCIDENT DOCUMENTATION ‚ö†Ô∏è</p>\n                <p style=\"font-size: 12px; font-weight: normal; margin-top: 10px;\">\n                    This report contains sensitive information and should only be accessed by authorized personnel\n                </p>\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n\nconst requestBody = {\n    source: htmlContent,\n    format: \"A4\",\n    margin: \"0.5cm\",\n    landscape: false\n};\n\nreturn [{\n    json: {\n        ...reportData,\n        pdfRequestBody: requestBody\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1856,
        80
      ],
      "id": "702b8040-264a-404e-bf8f-9df4f8b53902",
      "name": "Stylish Incident Report Structure"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Get the report data and form data\nconst reportData = $input.item.json;\nconst formData = $json;\n\n// Helper function for checking values\nconst hasValue = (fieldName) => {\n    const value = formData[fieldName];\n    return value && value.trim() !== '' && \n           !value.toLowerCase().includes('not specified') &&\n           !value.toLowerCase().includes('not recorded') &&\n           !value.toLowerCase().includes('none') &&\n           !value.toLowerCase().includes('n/a') &&\n           value.trim() !== '-';\n};\n\n// Check if there's actually an incident - if not, this report shouldn't be generated\nconst hasActualIncident = formData['Did any incidents occur during this shift?']?.toLowerCase().includes('yes') ||\n                         hasValue('Incident Date and Time') ||\n                         hasValue('Location of Incident') ||\n                         hasValue('Describe What Happened');\n\n// If no real incident, skip this node\nif (!hasActualIncident) {\n    throw new Error(\"SKIP_NO_INCIDENT\");  // Triggers Continue On Fail\n}\n\n// Extract date and time from incident timestamp\nconst incidentDateTime = formData['Incident Date and Time'] || '';\nconst [incidentDate, incidentTime] = incidentDateTime.split(' ');\n\nconst htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: Arial, sans-serif; \n            line-height: 1.4; \n            color: #333; \n            background: white;\n            padding: 20px;\n            font-size: 11px;\n        }\n        \n        .container {\n            max-width: 210mm;\n            margin: 0 auto;\n            background: white;\n        }\n        \n        .basic-info {\n            margin-bottom: 20px;\n        }\n        \n        .info-row {\n            margin-bottom: 8px;\n        }\n        \n        .info-label {\n            color: #000;\n            font-weight: bold;\n            font-size: 12px;\n            display: inline;\n        }\n        \n        .info-value {\n            color: #333;\n            font-size: 12px;\n            display: inline;\n            margin-left: 5px;\n        }\n        \n        .shift-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            border: 2px solid #5B9BD5;\n        }\n        \n        .shift-table th,\n        .shift-table td {\n            border: 1px solid #5B9BD5;\n            padding: 8px;\n            text-align: left;\n            font-size: 11px;\n        }\n        \n        .shift-table th {\n            background-color: white;\n            color: #000;\n            font-weight: bold;\n        }\n        \n        .shift-table td {\n            background-color: white;\n        }\n        \n        .section-header {\n            background-color: #5B9BD5;\n            color: white;\n            padding: 8px 12px;\n            font-weight: bold;\n            font-size: 12px;\n            margin-top: 20px;\n            margin-bottom: 0;\n            border: 2px solid #5B9BD5;\n        }\n        \n        .content-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 0;\n            border: 2px solid #5B9BD5;\n            border-top: none;\n        }\n        \n        .content-table th,\n        .content-table td {\n            border: 1px solid #5B9BD5;\n            padding: 8px;\n            text-align: left;\n            vertical-align: top;\n            font-size: 10px;\n        }\n        \n        .content-table th {\n            background-color: #B4C6E7;\n            color: #2F5597;\n            font-weight: bold;\n            width: 30%;\n        }\n        \n        .content-table td {\n            background-color: white;\n            color: #333;\n        }\n        \n        .two-col-row th {\n            width: 25%;\n        }\n        \n        .two-col-row td {\n            width: 25%;\n        }\n        \n        .footer {\n            text-align: center;\n            margin-top: 30px;\n            font-size: 10px;\n            color: #666;\n            padding-top: 15px;\n        }\n        \n        @media print {\n            body { padding: 10px; }\n            * { -webkit-print-color-adjust: exact; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header Title -->\n        <div style=\"text-align: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid #5B9BD5;\">\n            <h1 style=\"color: #2F5597; font-size: 24px; font-weight: bold; margin: 0;\">Incident Report</h1>\n        </div>\n        \n        <!-- Basic Information -->\n        <div class=\"basic-info\">\n            <div class=\"info-row\">\n                <span class=\"info-label\">Client Name :</span>\n                <span class=\"info-value\">${formData['Participant Full Name'] || 'Not specified'}</span>\n            </div>\n            \n            <div class=\"info-row\">\n                <span class=\"info-label\">Support Staff Name :</span>\n                <span class=\"info-value\">${formData['Staff Full Name'] || 'Not specified'}</span>\n            </div>\n        </div>\n        \n        <!-- Shift Times Table -->\n        <table class=\"shift-table\">\n            <tr>\n                <th>Shift Sign In Date & Time</th>\n                <td>${formData['Sign In Date & Time'] || 'Not recorded'}</td>\n                <th>Shift Sign Out Date & Time</th>\n                <td>${formData['Sign Out Date & Time'] || 'Not recorded'}</td>\n            </tr>\n            <tr>\n                <th>Shift Status</th>\n                <td colspan=\"3\">Completed</td>\n            </tr>\n        </table>\n        \n        <!-- Situation Section -->\n        <div class=\"section-header\">Situation</div>\n        <table class=\"content-table\">\n            <tr class=\"two-col-row\">\n                <th>Date of Incident</th>\n                <td>${incidentDate || 'Not specified'}</td>\n                <th>Time of Incident</th>\n                <td>${incidentTime || 'Not specified'}</td>\n            </tr>\n            <tr>\n                <th>Location of Incident</th>\n                <td colspan=\"3\">${formData['Location of Incident'] || 'Not specified'}</td>\n            </tr>\n            <tr>\n                <th>People Involved</th>\n                <td colspan=\"3\">${formData['People Involved'] || 'Not specified'}</td>\n            </tr>\n            <tr>\n                <th>Describe What Happened</th>\n                <td colspan=\"3\">${formData['Describe What Happened'] || 'No description provided'}</td>\n            </tr>\n        </table>\n        \n        <!-- Trigger Section -->\n        <div class=\"section-header\">Trigger</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>What led up to the incident?</th>\n                <td colspan=\"3\">${formData['What led up to the incident?'] || 'Not specified'}</td>\n            </tr>\n        </table>\n        \n        <!-- Action Section -->\n        <div class=\"section-header\">Action</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>Actions Taken / Response</th>\n                <td colspan=\"3\">${formData['Actions Taken / Response'] || 'No actions recorded'}</td>\n            </tr>\n            <tr>\n                <th>Was it reported? If yes, to whom and how?</th>\n                <td colspan=\"3\">${formData['Was it reported? If yes, to whom and how?'] || 'Reporting status unknown'}</td>\n            </tr>\n        </table>\n        \n        <!-- Result Section -->\n        <div class=\"section-header\">Result</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>Outcome of the Incident</th>\n                <td colspan=\"3\">${formData['Outcome of the Incident'] || 'Outcome not recorded'}</td>\n            </tr>\n            <tr>\n                <th>Follow-up / Recommendations</th>\n                <td colspan=\"3\">${formData['Follow-up / Recommendations'] || 'No recommendations provided'}</td>\n            </tr>\n        </table>\n        \n        <!-- Footer -->\n        <div class=\"footer\">\n            <p><strong>Incident Report Generated</strong></p>\n            <p>Participant: ${formData['Participant Full Name'] || 'Unknown'} | Staff: ${formData['Staff Full Name'] || 'Unknown'}</p>\n            <p>Generated: ${new Date().toLocaleDateString()}, ${new Date().toLocaleTimeString()}</p>\n            <p>Report ID: INC-${Date.now()}</p>\n        </div>\n    </div>\n</body>\n</html>`;\n\nconst requestBody = {\n    source: htmlContent,\n    format: \"A4\",\n    margin: \"0.4cm\",\n    landscape: false\n};\n\n// Create clean filename using actual incident date\nconst clientName = formData['Participant Full Name'] || 'Unknown_Client';\nconst cleanClientName = clientName.replace(/[^a-zA-Z0-9]/g, '_');\n\n// Use incidentDate from line 31 (already extracted), with fallback\nconst fileDate = incidentDate || \n                 formData['Sign In Date & Time']?.split(' ')[0] || \n                 new Date().toISOString().split('T')[0];\n\nconst incidentReportTitle = `Incident_Report_${cleanClientName}_${fileDate}`;\n\nreturn {\n    json: {\n        ...reportData,\n        pdfRequestBody: requestBody,\n        title: incidentReportTitle,\n        clientName: clientName,\n        reportDate: fileDate\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1296,
        864
      ],
      "id": "ca969547-67e1-4893-898f-1194d3acd8df",
      "name": "Incident Report Format",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "content": "## Stylish Report Format",
        "height": 304,
        "width": 1600
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1456,
        0
      ],
      "id": "f232b407-e297-4901-b2d9-d052e10292c6",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "jsCode": "// Complete Client Report Generator - Rule-Based Analysis\nconst processedData = $input.first().json.processedData;\nconst clientReports = [];\n\n// Generate comprehensive reports for each client who had shifts this week\nObject.values(processedData.clientWeeklyData).forEach(client => {\n    if (client.totalShifts > 0) {\n        const report = generateClientWeeklyReport(client, processedData.reportPeriod);\n        clientReports.push(report);\n    }\n});\n\nconsole.log(`Generated ${clientReports.length} client weekly reports`);\n\nreturn clientReports.map(report => ({\n    json: {\n        reportType: 'client_weekly',\n        clientCode: report.clientCode,\n        clientName: report.clientName,\n        title: report.filename,\n        htmlContent: report.htmlContent,\n        pdfRequestBody: {\n            source: report.htmlContent,\n            format: \"A4\",\n            margin: \"0.5cm\",\n            landscape: false\n        }\n    }\n}));\n\nfunction generateClientWeeklyReport(client, reportPeriod) {\n    const reportDate = new Date().toLocaleDateString();\n    const reportTime = new Date().toLocaleTimeString();\n    \n    const htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n            line-height: 1.6; \n            color: #333; \n            background: #f8f9fa;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 900px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            overflow: hidden;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%);\n            color: white;\n            padding: 40px;\n            text-align: center;\n        }\n        \n        .header h1 {\n            font-size: 32px;\n            font-weight: 600;\n            margin-bottom: 10px;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n        }\n        \n        .header .subtitle {\n            font-size: 18px;\n            opacity: 0.95;\n            background: rgba(255,255,255,0.2);\n            padding: 8px 20px;\n            border-radius: 20px;\n            display: inline-block;\n        }\n        \n        .client-info {\n            background: #e3f2fd;\n            padding: 25px;\n            border-bottom: 3px solid #2196F3;\n        }\n        \n        .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr 1fr;\n            gap: 20px;\n            text-align: center;\n        }\n        \n        .info-card {\n            background: white;\n            padding: 20px;\n            border-radius: 10px;\n            border-left: 4px solid #2196F3;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        \n        .info-label {\n            font-size: 12px;\n            color: #1976D2;\n            font-weight: 600;\n            text-transform: uppercase;\n            margin-bottom: 8px;\n            letter-spacing: 1px;\n        }\n        \n        .info-value {\n            font-size: 18px;\n            font-weight: 600;\n            color: #0D47A1;\n        }\n        \n        .content {\n            padding: 30px;\n        }\n        \n        .section {\n            margin-bottom: 30px;\n            border-radius: 10px;\n            overflow: hidden;\n            border: 1px solid #e0e0e0;\n            background: white;\n        }\n        \n        .section-header {\n            background: #37474F;\n            color: white;\n            padding: 15px 20px;\n            font-weight: 600;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n        }\n        \n        .section-content {\n            padding: 25px;\n        }\n        \n        .metric-card {\n            background: #f8f9fa;\n            border-left: 4px solid #4CAF50;\n            padding: 15px;\n            margin-bottom: 15px;\n            border-radius: 0 8px 8px 0;\n        }\n        \n        .metric-card.warning {\n            border-left-color: #FF9800;\n            background: #fff8e1;\n        }\n        \n        .metric-card.critical {\n            border-left-color: #F44336;\n            background: #ffebee;\n        }\n        \n        .metric-title {\n            font-weight: 600;\n            margin-bottom: 8px;\n            color: #37474F;\n        }\n        \n        .metric-value {\n            font-size: 24px;\n            font-weight: 700;\n            color: #2E7D32;\n            margin-bottom: 5px;\n        }\n        \n        .metric-description {\n            font-size: 14px;\n            color: #666;\n            line-height: 1.4;\n        }\n        \n        .progress-bar {\n            background: #e0e0e0;\n            border-radius: 10px;\n            height: 8px;\n            margin: 10px 0;\n            overflow: hidden;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            border-radius: 10px;\n            transition: width 0.3s ease;\n        }\n        \n        .progress-excellent { background: #4CAF50; }\n        .progress-good { background: #8BC34A; }\n        .progress-fair { background: #FFC107; }\n        .progress-poor { background: #FF5722; }\n        \n        .shift-timeline {\n            background: #f5f5f5;\n            border-radius: 8px;\n            padding: 20px;\n            margin: 15px 0;\n        }\n        \n        .shift-item {\n            background: white;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 10px;\n            border-left: 3px solid #2196F3;\n        }\n        \n        .shift-date {\n            font-weight: 600;\n            color: #1976D2;\n            margin-bottom: 5px;\n        }\n        \n        .shift-details {\n            font-size: 14px;\n            color: #555;\n        }\n        \n        .prn-item {\n            background: #fff5f5;\n            border: 1px solid #dc3545;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 15px;\n        }\n        \n        .incident-item {\n            background: #ffebee;\n            border: 2px solid #f44336;\n            border-radius: 8px;\n            padding: 20px;\n            margin-bottom: 15px;\n        }\n        \n        .appointment-item {\n            background: #e8f5e8;\n            border: 1px solid #4caf50;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 10px;\n        }\n        \n        .recommendation-box {\n            background: linear-gradient(45deg, #E8F5E8, #F0F8FF);\n            border: 2px solid #4CAF50;\n            border-radius: 10px;\n            padding: 20px;\n            margin: 20px 0;\n        }\n        \n        .recommendation-title {\n            color: #2E7D32;\n            font-weight: 600;\n            margin-bottom: 15px;\n            font-size: 16px;\n        }\n        \n        .recommendation-list {\n            list-style: none;\n            padding: 0;\n        }\n        \n        .recommendation-list li {\n            background: white;\n            padding: 10px 15px;\n            margin-bottom: 8px;\n            border-radius: 6px;\n            border-left: 3px solid #4CAF50;\n        }\n        \n        .footer {\n            background: #37474F;\n            color: white;\n            padding: 25px;\n            text-align: center;\n        }\n        \n        .report-id {\n            background: rgba(255,255,255,0.2);\n            padding: 8px 16px;\n            border-radius: 20px;\n            display: inline-block;\n            font-family: monospace;\n            font-size: 12px;\n            margin-bottom: 10px;\n        }\n        \n        @media print {\n            body { padding: 0; background: white; }\n            .container { box-shadow: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>CLIENT WEEKLY REPORT</h1>\n            <div class=\"subtitle\">Comprehensive Care Analysis</div>\n        </div>\n        \n        <div class=\"client-info\">\n            <div class=\"info-grid\">\n                <div class=\"info-card\">\n                    <div class=\"info-label\">Client</div>\n                    <div class=\"info-value\">${client.clientName}</div>\n                </div>\n                <div class=\"info-card\">\n                    <div class=\"info-label\">Report Period</div>\n                    <div class=\"info-value\">${reportPeriod.startDate} - ${reportPeriod.endDate}</div>\n                </div>\n                <div class=\"info-card\">\n                    <div class=\"info-label\">Total Shifts</div>\n                    <div class=\"info-value\">${client.totalShifts}</div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"content\">\n            <!-- Health & Safety Metrics -->\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üè• HEALTH & SAFETY METRICS\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"metric-card ${getMetricClass(client.medicationCompliance.complianceRate)}\">\n                        <div class=\"metric-title\">Medication Compliance</div>\n                        <div class=\"metric-value\">${client.medicationCompliance.complianceRate}%</div>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill ${getProgressClass(client.medicationCompliance.complianceRate)}\" style=\"width: ${client.medicationCompliance.complianceRate}%\"></div>\n                        </div>\n                        <div class=\"metric-description\">\n                            ${client.medicationCompliance.totalAdministrations} total administrations, \n                            ${client.medicationCompliance.issues.length} issues reported\n                        </div>\n                    </div>\n                    \n                    <div class=\"metric-card ${getMetricClass(client.nutritionMetrics.complianceRate)}\">\n                        <div class=\"metric-title\">Nutrition Compliance</div>\n                        <div class=\"metric-value\">${client.nutritionMetrics.complianceRate}%</div>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill ${getProgressClass(client.nutritionMetrics.complianceRate)}\" style=\"width: ${client.nutritionMetrics.complianceRate}%\"></div>\n                        </div>\n                        <div class=\"metric-description\">\n                            ${client.nutritionMetrics.adequateIntakeCount} adequate intake shifts, \n                            ${client.nutritionMetrics.inadequateIntakeCount} concerns noted\n                        </div>\n                    </div>\n                    \n                    ${client.incidentSummary.totalIncidents > 0 ? `\n                    <div class=\"metric-card critical\">\n                        <div class=\"metric-title\">Safety Incidents</div>\n                        <div class=\"metric-value\">${client.incidentSummary.totalIncidents}</div>\n                        <div class=\"metric-description\">\n                            Requires immediate attention and review\n                        </div>\n                    </div>` : `\n                    <div class=\"metric-card\">\n                        <div class=\"metric-title\">Safety Record</div>\n                        <div class=\"metric-value\">‚úì No Incidents</div>\n                        <div class=\"metric-description\">Excellent safety record maintained this week</div>\n                    </div>`}\n                </div>\n            </div>\n            \n            <!-- Medication Details -->\n            ${client.medicationCompliance.prnUsage.length > 0 || client.medicationCompliance.issues.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üíä MEDICATION MANAGEMENT\n                </div>\n                <div class=\"section-content\">\n                    ${client.medicationCompliance.issues.length > 0 ? `\n                    <h4 style=\"color: #f44336; margin-bottom: 15px;\">Medication Issues Reported:</h4>\n                    ${client.medicationCompliance.issues.map(issue => `\n                        <div class=\"metric-card critical\">\n                            <div class=\"metric-title\">Issue on ${new Date(issue.date).toLocaleDateString()}</div>\n                            <div class=\"metric-description\">\n                                <strong>Issue:</strong> ${issue.issue}<br>\n                                <strong>Medications:</strong> ${issue.medications || 'Not specified'}<br>\n                                <strong>Time:</strong> ${issue.time || 'Not specified'}\n                            </div>\n                        </div>\n                    `).join('')}` : ''}\n                    \n                    ${client.medicationCompliance.prnUsage.length > 0 ? `\n                    <h4 style=\"color: #2196f3; margin: 20px 0 15px 0;\">PRN Medications Administered:</h4>\n                    ${client.medicationCompliance.prnUsage.map(prn => `\n                        <div class=\"prn-item\">\n                            <div style=\"font-weight: 600; color: #dc3545;\">${prn.medication}</div>\n                            <div style=\"margin-top: 8px;\">\n                                <strong>Dose:</strong> ${prn.dose || 'Not specified'}<br>\n                                <strong>Time:</strong> ${prn.timeGiven || 'Not specified'}<br>\n                                <strong>Reason:</strong> ${prn.reason || 'Not specified'}<br>\n                                <strong>Outcome:</strong> ${prn.outcome || 'Not specified'}\n                            </div>\n                        </div>\n                    `).join('')}` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Nutrition & Swallowing -->\n            ${client.nutritionMetrics.concerns.length > 0 || client.swallowingAndSafety.swallowingDifficulties.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üçΩÔ∏è NUTRITION & SWALLOWING SAFETY\n                </div>\n                <div class=\"section-content\">\n                    ${client.nutritionMetrics.concerns.length > 0 ? `\n                    <h4 style=\"color: #ff9800; margin-bottom: 15px;\">Nutrition Concerns:</h4>\n                    ${client.nutritionMetrics.concerns.map(concern => `\n                        <div class=\"metric-card warning\">\n                            <div class=\"metric-title\">Date: ${new Date(concern.date).toLocaleDateString()}</div>\n                            <div class=\"metric-description\">\n                                <strong>Issue:</strong> ${concern.reason}<br>\n                                ${concern.mealDetails ? `<strong>Meal Details:</strong> ${concern.mealDetails}<br>` : ''}\n                                ${concern.hydration ? `<strong>Hydration:</strong> ${concern.hydration}` : ''}\n                            </div>\n                        </div>\n                    `).join('')}` : ''}\n                    \n                    ${client.swallowingAndSafety.swallowingDifficulties.length > 0 ? `\n                    <h4 style=\"color: #f44336; margin: 20px 0 15px 0;\">Swallowing Difficulties:</h4>\n                    ${client.swallowingAndSafety.swallowingDifficulties.map(difficulty => `\n                        <div class=\"metric-card critical\">\n                            <div class=\"metric-title\">Swallowing Issue - ${new Date(difficulty.date).toLocaleDateString()}</div>\n                            <div class=\"metric-description\">${difficulty.description}</div>\n                        </div>\n                    `).join('')}` : ''}\n                    \n                    ${client.swallowingAndSafety.chokingIncidents.length > 0 ? `\n                    <h4 style=\"color: #f44336; margin: 20px 0 15px 0;\">Choking/Coughing Incidents:</h4>\n                    ${client.swallowingAndSafety.chokingIncidents.map(incident => `\n                        <div class=\"metric-card critical\">\n                            <div class=\"metric-title\">Choking Concern - ${new Date(incident.date).toLocaleDateString()}</div>\n                            <div class=\"metric-description\">${incident.description}</div>\n                        </div>\n                    `).join('')}` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Incidents -->\n            ${client.incidentSummary.totalIncidents > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    ‚ö†Ô∏è INCIDENT REPORTS\n                </div>\n                <div class=\"section-content\">\n                    ${client.incidentSummary.incidentDetails.map(incident => `\n                        <div class=\"incident-item\">\n                            <div style=\"font-weight: 600; color: #f44336; margin-bottom: 10px;\">\n                                Incident on ${incident.dateTime ? new Date(incident.dateTime).toLocaleDateString() : 'Date not specified'}\n                            </div>\n                            <div style=\"margin-bottom: 8px;\"><strong>Location:</strong> ${incident.location || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 8px;\"><strong>Description:</strong> ${incident.description || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 8px;\"><strong>People Involved:</strong> ${incident.peopleInvolved || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 8px;\"><strong>Actions Taken:</strong> ${incident.actionsTaken || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 8px;\"><strong>Outcome:</strong> ${incident.outcome || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 8px;\"><strong>Reported To:</strong> ${incident.reportedTo || 'Not specified'}</div>\n                            <div><strong>Follow-up:</strong> ${incident.followUp || 'Not specified'}</div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>` : ''}\n            \n            <!-- Community & Activities -->\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üéØ COMMUNITY PARTICIPATION & ACTIVITIES\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"metric-card\">\n                        <div class=\"metric-title\">Community Participation Rate</div>\n                        <div class=\"metric-value\">${client.appointmentsAndActivities.participationRate || 0}%</div>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill ${getProgressClass(client.appointmentsAndActivities.participationRate || 0)}\" style=\"width: ${client.appointmentsAndActivities.participationRate || 0}%\"></div>\n                        </div>\n                        <div class=\"metric-description\">\n                            ${client.appointmentsAndActivities.communityParticipation} out of ${client.totalShifts} shifts included community activities\n                        </div>\n                    </div>\n                    \n                    ${client.appointmentsAndActivities.communityDetails.length > 0 ? `\n                    <h4 style=\"color: #ff9800; margin: 20px 0 15px 0;\">Community Participation Issues:</h4>\n                    ${client.appointmentsAndActivities.communityDetails.map(detail => `\n                        <div class=\"metric-card warning\">\n                            <div class=\"metric-title\">Non-participation - ${new Date(detail.date).toLocaleDateString()}</div>\n                            <div class=\"metric-description\">\n                                <strong>Reason:</strong> ${detail.reason || 'Not specified'}<br>\n                                <strong>Response:</strong> ${detail.response || 'Not specified'}\n                            </div>\n                        </div>\n                    `).join('')}` : ''}\n                </div>\n            </div>\n            \n            <!-- Appointments -->\n            ${client.appointmentsAndActivities.appointmentDetails.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üìÖ APPOINTMENTS & HEALTHCARE\n                </div>\n                <div class=\"section-content\">\n                    ${client.appointmentsAndActivities.appointmentDetails.map(appointment => `\n                        <div class=\"appointment-item\">\n                            <div style=\"font-weight: 600; color: #4caf50; margin-bottom: 10px;\">\n                                ${appointment.type || 'Appointment'} - ${new Date(appointment.date).toLocaleDateString()}\n                            </div>\n                            <div style=\"margin-bottom: 5px;\"><strong>Purpose:</strong> ${appointment.purpose || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 5px;\"><strong>Professional:</strong> ${appointment.professionalName || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 5px;\"><strong>Clinic:</strong> ${appointment.clinicName || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 5px;\"><strong>Summary:</strong> ${appointment.summary || 'Not specified'}</div>\n                            <div style=\"margin-bottom: 5px;\"><strong>Follow-up Actions:</strong> ${appointment.followUpActions || 'None specified'}</div>\n                            <div><strong>Next Appointment:</strong> ${appointment.nextAppointment || 'Not scheduled'}</div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>` : ''}\n            \n            <!-- Behavioral Observations -->\n            ${client.behavioralObservations.moodPatterns.length > 0 || client.behavioralObservations.healthConcerns.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üß† BEHAVIORAL OBSERVATIONS\n                </div>\n                <div class=\"section-content\">\n                    ${client.behavioralObservations.moodPatterns.length > 0 ? `\n                    <h4 style=\"color: #2196f3; margin-bottom: 15px;\">Mood & Behavior Observations:</h4>\n                    <div class=\"shift-timeline\">\n                        ${client.behavioralObservations.moodPatterns.map(pattern => `\n                            <div class=\"shift-item\">\n                                <div class=\"shift-date\">${new Date(pattern.date).toLocaleDateString()}</div>\n                                <div class=\"shift-details\">${pattern.observation}</div>\n                            </div>\n                        `).join('')}\n                    </div>` : ''}\n                    \n                    ${client.behavioralObservations.healthConcerns.length > 0 ? `\n                    <h4 style=\"color: #ff9800; margin: 20px 0 15px 0;\">Health Concerns Noted:</h4>\n                    ${client.behavioralObservations.healthConcerns.map(concern => `\n                        <div class=\"metric-card warning\">\n                            <div class=\"metric-title\">Health Concern - ${new Date(concern.date).toLocaleDateString()}</div>\n                            <div class=\"metric-description\">${concern.concern}</div>\n                        </div>\n                    `).join('')}` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Weekly Shift Summary -->\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üìã WEEKLY SHIFT SUMMARY\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"shift-timeline\">\n                        ${client.shiftDetails.map(shift => `\n                            <div class=\"shift-item\">\n                                <div class=\"shift-date\">${new Date(shift.timestamp).toLocaleDateString()} - ${shift.staffMember}</div>\n                                <div class=\"shift-details\">\n                                    <strong>Location:</strong> ${shift.location || 'Not specified'}<br>\n                                    <strong>Shift Time:</strong> ${shift.signIn || 'Not recorded'} to ${shift.signOut || 'Not recorded'}<br>\n                                    ${shift.activities ? `<strong>Activities:</strong> ${shift.activities}<br>` : ''}\n                                    ${shift.behavior ? `<strong>Behavior Notes:</strong> ${shift.behavior}<br>` : ''}\n                                    ${shift.handoverTo ? `<strong>Handover:</strong> ${shift.handoverTo}` : ''}\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Care Plan Recommendations -->\n            <div class=\"recommendation-box\">\n                <div class=\"recommendation-title\">üìã CARE PLAN RECOMMENDATIONS</div>\n                <ul class=\"recommendation-list\">\n                    ${client.weeklyInsights.recommendations.length > 0 ? \n                        client.weeklyInsights.recommendations.map(rec => `<li>${rec}</li>`).join('') :\n                        '<li>Continue current care plan monitoring and documentation</li>'\n                    }\n                    ${generateAdditionalRecommendations(client).map(rec => `<li>${rec}</li>`).join('')}\n                </ul>\n                \n                ${client.weeklyInsights.strengths.length > 0 ? `\n                <h4 style=\"color: #4caf50; margin: 20px 0 10px 0;\">Strengths & Positive Outcomes:</h4>\n                <ul class=\"recommendation-list\">\n                    ${client.weeklyInsights.strengths.map(strength => `<li style=\"border-left-color: #4caf50;\">${strength}</li>`).join('')}\n                </ul>` : ''}\n                \n                ${client.weeklyInsights.concerns.length > 0 ? `\n                <h4 style=\"color: #ff9800; margin: 20px 0 10px 0;\">Areas Requiring Attention:</h4>\n                <ul class=\"recommendation-list\">\n                    ${client.weeklyInsights.concerns.map(concern => `<li style=\"border-left-color: #ff9800;\">${typeof concern === 'object' ? concern.description : concern}</li>`).join('')}\n                </ul>` : ''}\n            </div>\n        </div>\n        \n        <div class=\"footer\">\n            <div class=\"report-id\">CLIENT-${client.clientCode}-${Date.now()}</div>\n            <div>Generated: ${reportDate} ${reportTime}</div>\n            <div style=\"font-size: 13px; margin-top: 5px; opacity: 0.9;\">\n                Rule-Based Analysis System - Client Care Analytics\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n\n    return {\n        clientCode: client.clientCode,\n        clientName: client.clientName,\n        filename: `${client.clientCode}_${client.clientName.replace(/\\s+/g, '_')}_Weekly_Report_${reportPeriod.startDate.replace(/\\//g, '-')}`,\n        htmlContent: htmlContent\n    };\n}\n\nfunction getMetricClass(value) {\n    if (value >= 95) return '';\n    if (value >= 80) return 'warning';\n    return 'critical';\n}\n\nfunction getProgressClass(value) {\n    if (value >= 95) return 'progress-excellent';\n    if (value >= 85) return 'progress-good';\n    if (value >= 70) return 'progress-fair';\n    return 'progress-poor';\n}\n\nfunction generateAdditionalRecommendations(client) {\n    const recommendations = [];\n    \n    // Medication-based recommendations\n    if (client.medicationCompliance.complianceRate < 95) {\n        recommendations.push('Review medication administration protocols and timing');\n    }\n    if (client.medicationCompliance.prnUsage.length > 2) {\n        recommendations.push('Assess pain management and behavioral support strategies');\n    }\n    \n    // Nutrition-based recommendations\n    if (client.nutritionMetrics.complianceRate < 85) {\n        recommendations.push('Consult with dietitian for nutrition plan optimization');\n    }\n    \n    // Safety-based recommendations\n    if (client.swallowingAndSafety.swallowingDifficulties.length > 0) {\n        recommendations.push('Speech pathology assessment for swallowing safety');\n    }\n    if (client.incidentSummary.totalIncidents > 0) {\n        recommendations.push('Implement enhanced safety monitoring and risk prevention measures');\n    }\n    \n    // Community participation\n    if ((client.appointmentsAndActivities.participationRate || 0) < 60) {\n        recommendations.push('Develop personalized community engagement strategies');\n    }\n    \n    // General recommendations\n    recommendations.push('Schedule family communication meeting to discuss weekly progress');\n    recommendations.push('Review care plan goals and update as needed for next period');\n    \n    return recommendations;\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        80
      ],
      "id": "51f455e8-c0f5-4091-93bd-1ec632d60da7",
      "name": "Stylish Weekly Client Report Generator",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// Complete Staff Report Generator - Rule-Based Analysis\nconst processedData = $input.first().json.processedData;\nconst staffReports = [];\n\n// Generate comprehensive reports for each staff member who worked this week\nObject.values(processedData.staffWeeklyData).forEach(staff => {\n    if (staff.totalShifts > 0) {\n        const report = generateStaffWeeklyReport(staff, processedData.reportPeriod);\n        staffReports.push(report);\n    }\n});\n\nconsole.log(`Generated ${staffReports.length} staff weekly reports`);\n\nreturn staffReports.map(report => ({\n    json: {\n        reportType: 'staff_weekly',\n        staffCode: report.staffCode,\n        staffName: report.staffName,\n        title: report.filename,\n        htmlContent: report.htmlContent,\n        pdfRequestBody: {\n            source: report.htmlContent,\n            format: \"A4\",\n            margin: \"0.5cm\",\n            landscape: false\n        }\n    }\n}));\n\nfunction generateStaffWeeklyReport(staff, reportPeriod) {\n    const reportDate = new Date().toLocaleDateString();\n    const reportTime = new Date().toLocaleTimeString();\n    \n    const htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \n            line-height: 1.6; \n            color: #333; \n            background: #f8f9fa;\n            padding: 20px;\n        }\n        \n        .container {\n            max-width: 900px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            overflow: hidden;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #6A4C93 0%, #8E44AD 100%);\n            color: white;\n            padding: 40px;\n            text-align: center;\n        }\n        \n        .header h1 {\n            font-size: 32px;\n            font-weight: 600;\n            margin-bottom: 10px;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n        }\n        \n        .header .subtitle {\n            font-size: 18px;\n            opacity: 0.95;\n            background: rgba(255,255,255,0.2);\n            padding: 8px 20px;\n            border-radius: 20px;\n            display: inline-block;\n        }\n        \n        .staff-info {\n            background: #f3e5f5;\n            padding: 25px;\n            border-bottom: 3px solid #9C27B0;\n        }\n        \n        .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr 1fr;\n            gap: 20px;\n            text-align: center;\n        }\n        \n        .info-card {\n            background: white;\n            padding: 20px;\n            border-radius: 10px;\n            border-left: 4px solid #9C27B0;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        \n        .info-label {\n            font-size: 12px;\n            color: #7B1FA2;\n            font-weight: 600;\n            text-transform: uppercase;\n            margin-bottom: 8px;\n            letter-spacing: 1px;\n        }\n        \n        .info-value {\n            font-size: 18px;\n            font-weight: 600;\n            color: #4A148C;\n        }\n        \n        .content {\n            padding: 30px;\n        }\n        \n        .section {\n            margin-bottom: 30px;\n            border-radius: 10px;\n            overflow: hidden;\n            border: 1px solid #e0e0e0;\n            background: white;\n        }\n        \n        .section-header {\n            background: #5D4E75;\n            color: white;\n            padding: 15px 20px;\n            font-weight: 600;\n            font-size: 16px;\n        }\n        \n        .section-content {\n            padding: 25px;\n        }\n        \n        .performance-card {\n            background: #f8f9fa;\n            border-left: 4px solid #673AB7;\n            padding: 15px;\n            margin-bottom: 15px;\n            border-radius: 0 8px 8px 0;\n        }\n        \n        .performance-card.excellent {\n            border-left-color: #4CAF50;\n            background: #f1f8e9;\n        }\n        \n        .performance-card.good {\n            border-left-color: #8BC34A;\n            background: #f7ffef;\n        }\n        \n        .performance-card.needs-attention {\n            border-left-color: #FF9800;\n            background: #fff8e1;\n        }\n        \n        .performance-card.critical {\n            border-left-color: #F44336;\n            background: #ffebee;\n        }\n        \n        .performance-title {\n            font-weight: 600;\n            margin-bottom: 8px;\n            color: #37474F;\n        }\n        \n        .performance-value {\n            font-size: 20px;\n            font-weight: 700;\n            color: #673AB7;\n            margin-bottom: 5px;\n        }\n        \n        .performance-description {\n            font-size: 14px;\n            color: #666;\n            line-height: 1.4;\n        }\n        \n        .progress-bar {\n            background: #e0e0e0;\n            border-radius: 10px;\n            height: 8px;\n            margin: 10px 0;\n            overflow: hidden;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            border-radius: 10px;\n            transition: width 0.3s ease;\n        }\n        \n        .progress-excellent { background: #4CAF50; }\n        .progress-good { background: #8BC34A; }\n        .progress-fair { background: #FFC107; }\n        .progress-needs-improvement { background: #FF5722; }\n        \n        .client-list {\n            background: #f5f5f5;\n            border-radius: 8px;\n            padding: 15px;\n            margin: 15px 0;\n        }\n        \n        .client-item {\n            background: white;\n            padding: 10px;\n            margin-bottom: 8px;\n            border-radius: 6px;\n            border-left: 3px solid #673AB7;\n        }\n        \n        .development-box {\n            background: linear-gradient(45deg, #E8EAF6, #F3E5F5);\n            border: 2px solid #673AB7;\n            border-radius: 10px;\n            padding: 20px;\n            margin: 20px 0;\n        }\n        \n        .development-title {\n            color: #4A148C;\n            font-weight: 600;\n            margin-bottom: 15px;\n            font-size: 16px;\n        }\n        \n        .strength-list, .improvement-list {\n            list-style: none;\n            padding: 0;\n        }\n        \n        .strength-list li {\n            background: #e8f5e8;\n            padding: 10px 15px;\n            margin-bottom: 8px;\n            border-radius: 6px;\n            border-left: 3px solid #4CAF50;\n        }\n        \n        .improvement-list li {\n            background: #fff3e0;\n            padding: 10px 15px;\n            margin-bottom: 8px;\n            border-radius: 6px;\n            border-left: 3px solid #FF9800;\n        }\n        \n        .concern-item {\n            background: #ffebee;\n            border: 1px solid #ffcdd2;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 10px;\n        }\n        \n        .training-item {\n            background: #e3f2fd;\n            border: 1px solid #bbdefb;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 10px;\n        }\n        \n        .incident-response {\n            background: #f1f8e9;\n            border: 1px solid #c8e6c9;\n            border-radius: 6px;\n            padding: 15px;\n            margin-bottom: 10px;\n        }\n        \n        .footer {\n            background: #5D4E75;\n            color: white;\n            padding: 25px;\n            text-align: center;\n        }\n        \n        .report-id {\n            background: rgba(255,255,255,0.2);\n            padding: 8px 16px;\n            border-radius: 20px;\n            display: inline-block;\n            font-family: monospace;\n            font-size: 12px;\n            margin-bottom: 10px;\n        }\n        \n        @media print {\n            body { padding: 0; background: white; }\n            .container { box-shadow: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>STAFF WEEKLY REPORT</h1>\n            <div class=\"subtitle\">Performance & Development Analysis</div>\n        </div>\n        \n        <div class=\"staff-info\">\n            <div class=\"info-grid\">\n                <div class=\"info-card\">\n                    <div class=\"info-label\">Staff Member</div>\n                    <div class=\"info-value\">${staff.staffName}</div>\n                </div>\n                <div class=\"info-card\">\n                    <div class=\"info-label\">Report Period</div>\n                    <div class=\"info-value\">${reportPeriod.startDate} - ${reportPeriod.endDate}</div>\n                </div>\n                <div class=\"info-card\">\n                    <div class=\"info-label\">Shifts Completed</div>\n                    <div class=\"info-value\">${staff.totalShifts}</div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"content\">\n            <!-- Performance Overview -->\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üìä PERFORMANCE OVERVIEW\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"performance-card ${getPerformanceClass(staff.weeklyPerformance.overallRating)}\">\n                        <div class=\"performance-title\">Overall Performance Rating</div>\n                        <div class=\"performance-value\">${staff.weeklyPerformance.overallRating}%</div>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill ${getProgressClass(staff.weeklyPerformance.overallRating)}\" style=\"width: ${staff.weeklyPerformance.overallRating}%\"></div>\n                        </div>\n                        <div class=\"performance-description\">\n                            Based on shift completion, care quality, and professional conduct\n                        </div>\n                    </div>\n                    \n                    <div class=\"performance-card\">\n                        <div class=\"performance-title\">Client Care Quality</div>\n                        <div class=\"performance-value\">${calculateCareQualityScore(staff)}%</div>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill ${getProgressClass(calculateCareQualityScore(staff))}\" style=\"width: ${calculateCareQualityScore(staff)}%\"></div>\n                        </div>\n                        <div class=\"performance-description\">\n                            Medication accuracy, safety protocols, and proactive care delivery\n                        </div>\n                    </div>\n                    \n                    <div class=\"performance-card\">\n                        <div class=\"performance-title\">Professional Reliability</div>\n                        <div class=\"performance-value\">${calculateReliabilityScore(staff)}%</div>\n                        <div class=\"progress-bar\">\n                            <div class=\"progress-fill ${getProgressClass(calculateReliabilityScore(staff))}\" style=\"width: ${calculateReliabilityScore(staff)}%\"></div>\n                        </div>\n                        <div class=\"performance-description\">\n                            Shift completion, documentation quality, and communication\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Client Assignments & Workload -->\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üë• CLIENT ASSIGNMENTS & WORKLOAD\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"performance-card\">\n                        <div class=\"performance-title\">Clients Supported This Week</div>\n                        <div class=\"performance-value\">${staff.clientsWorkedWith.length}</div>\n                        <div class=\"performance-description\">\n                            Demonstrates adaptability and client relationship management skills\n                        </div>\n                    </div>\n                    \n                    <div class=\"client-list\">\n                        <h4 style=\"color: #673AB7; margin-bottom: 10px;\">Client Care Delivered:</h4>\n                        ${staff.clientsWorkedWith.map(client => `\n                            <div class=\"client-item\">\n                                <strong>${client}</strong> - Professional care delivery maintained\n                            </div>\n                        `).join('')}\n                    </div>\n                    \n                    <div class=\"performance-card ${staff.clientsWorkedWith.length > 5 ? 'needs-attention' : ''}\">\n                        <div class=\"performance-title\">Workload Assessment</div>\n                        <div class=\"performance-value\">${getWorkloadAssessment(staff)}</div>\n                        <div class=\"performance-description\">\n                            ${staff.clientsWorkedWith.length > 5 ? 'High client caseload - monitor for burnout indicators' : 'Appropriate workload distribution maintained'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Care Delivery Excellence -->\n            ${staff.clientCareQuality.medicationManagement > 0 || staff.performanceMetrics.incidentHandling.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üè• CARE DELIVERY EXCELLENCE\n                </div>\n                <div class=\"section-content\">\n                    ${staff.clientCareQuality.medicationManagement > 0 ? `\n                    <div class=\"performance-card excellent\">\n                        <div class=\"performance-title\">Medication Management</div>\n                        <div class=\"performance-value\">‚úì Competent</div>\n                        <div class=\"performance-description\">\n                            Successfully managed medication administration for ${staff.clientCareQuality.medicationManagement} client(s) with accuracy and safety protocols\n                        </div>\n                    </div>` : ''}\n                    \n                    ${staff.performanceMetrics.incidentHandling.length > 0 ? `\n                    <div class=\"performance-card excellent\">\n                        <div class=\"performance-title\">Incident Response</div>\n                        <div class=\"performance-value\">‚úì Effective</div>\n                        <div class=\"performance-description\">\n                            Demonstrated professional incident management and crisis response capabilities\n                        </div>\n                    </div>\n                    \n                    <h4 style=\"color: #4CAF50; margin: 20px 0 10px 0;\">Incident Response Actions:</h4>\n                    ${staff.performanceMetrics.incidentHandling.map(response => `\n                        <div class=\"incident-response\">\n                            <strong>Action Taken:</strong> ${response || 'Professional response documented'}\n                        </div>\n                    `).join('')}` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Professional Development -->\n            <div class=\"development-box\">\n                <div class=\"development-title\">üìö PROFESSIONAL DEVELOPMENT</div>\n                \n                <h4 style=\"color: #4CAF50; margin-bottom: 10px;\">Strengths & Achievements:</h4>\n                <ul class=\"strength-list\">\n                    ${generateStaffStrengths(staff).map(strength => `<li>${strength}</li>`).join('')}\n                </ul>\n                \n                ${staff.professionalDevelopment.trainingNeeds.length > 0 ? `\n                <h4 style=\"color: #FF9800; margin: 20px 0 10px 0;\">Training & Development Needs:</h4>\n                <ul class=\"improvement-list\">\n                    ${staff.professionalDevelopment.trainingNeeds.map(need => `\n                        <li>\n                            <strong>Training Areas:</strong> ${need.areas || 'Not specified'}<br>\n                            <strong>Support Type:</strong> ${need.supportType || 'Not specified'}<br>\n                            <strong>Requested:</strong> ${new Date(need.date).toLocaleDateString()}\n                        </li>\n                    `).join('')}\n                </ul>` : ''}\n                \n                <h4 style=\"color: #2196F3; margin: 20px 0 10px 0;\">Development Recommendations:</h4>\n                <ul class=\"improvement-list\">\n                    ${generateDevelopmentRecommendations(staff).map(rec => `<li>${rec}</li>`).join('')}\n                </ul>\n            </div>\n            \n            <!-- Staff Wellbeing & Support -->\n            ${staff.wellbeingAndSupport.concernsRaised.length > 0 || staff.wellbeingAndSupport.supportRequested.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    ü§ù WELLBEING & SUPPORT\n                </div>\n                <div class=\"section-content\">\n                    ${staff.wellbeingAndSupport.concernsRaised.length > 0 ? `\n                    <h4 style=\"color: #FF5722; margin-bottom: 15px;\">Concerns & Support Needs:</h4>\n                    ${staff.wellbeingAndSupport.concernsRaised.map(concern => `\n                        <div class=\"concern-item\">\n                            <div style=\"font-weight: 600; margin-bottom: 8px;\">\n                                ${concern.type === 'shift_difficulty' ? 'Shift Difficulty' : \n                                  concern.type === 'general_concern' ? 'General Concern' : \n                                  concern.type === 'irc' ? concern.ircType : 'Concern'} - \n                                ${new Date(concern.date).toLocaleDateString()}\n                            </div>\n                            ${concern.rating ? `<div><strong>Rating:</strong> ${concern.rating}</div>` : ''}\n                            ${concern.explanation ? `<div><strong>Explanation:</strong> ${concern.explanation}</div>` : ''}\n                            ${concern.details ? `<div><strong>Details:</strong> ${concern.details}</div>` : ''}\n                            ${concern.description ? `<div><strong>Description:</strong> ${concern.description}</div>` : ''}\n                            ${concern.physicalEmotionalState ? `<div><strong>Physical/Emotional State:</strong> ${concern.physicalEmotionalState}</div>` : ''}\n                            ${concern.managementNotice ? `<div><strong>Management Notice:</strong> ${concern.managementNotice}</div>` : ''}\n                            ${concern.followUpRequested === 'Yes' ? '<div style=\"color: #f44336; font-weight: 600;\">‚ö†Ô∏è Follow-up requested</div>' : ''}\n                        </div>\n                    `).join('')}` : ''}\n                    \n                    ${staff.wellbeingAndSupport.supportRequested.length > 0 ? `\n                    <h4 style=\"color: #2196F3; margin: 20px 0 15px 0;\">Support Requested:</h4>\n                    ${staff.wellbeingAndSupport.supportRequested.map(support => `\n                        <div class=\"training-item\">\n                            <div><strong>Support Needed:</strong> ${support.support}</div>\n                            <div><strong>Date:</strong> ${new Date(support.date).toLocaleDateString()}</div>\n                        </div>\n                    `).join('')}` : ''}\n                </div>\n            </div>` : ''}\n            \n            <!-- Shift Performance Analysis -->\n            ${staff.wellbeingAndSupport.shiftDifficultyRatings.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üìà SHIFT PERFORMANCE ANALYSIS\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"performance-card\">\n                        <div class=\"performance-title\">Weekly Shift Assessment</div>\n                        <div class=\"performance-description\">\n                            ${analyzeShiftPerformance(staff.wellbeingAndSupport.shiftDifficultyRatings)}\n                        </div>\n                    </div>\n                    \n                    <h4 style=\"color: #673AB7; margin: 20px 0 10px 0;\">Individual Shift Ratings:</h4>\n                    <div class=\"client-list\">\n                        ${staff.wellbeingAndSupport.shiftDifficultyRatings.map((rating, index) => `\n                            <div class=\"client-item\">\n                                <strong>Shift ${index + 1}:</strong> ${rating}\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n            </div>` : ''}\n            \n            <!-- Training Progress & Goals -->\n            ${staff.professionalDevelopment.trainingNeeds.length > 0 ? `\n            <div class=\"section\">\n                <div class=\"section-header\">\n                    üéØ TRAINING PROGRESS & GOALS\n                </div>\n                <div class=\"section-content\">\n                    <div class=\"performance-card needs-attention\">\n                        <div class=\"performance-title\">Training Priority Level</div>\n                        <div class=\"performance-value\">${staff.professionalDevelopment.trainingNeeds.length > 2 ? 'High' : staff.professionalDevelopment.trainingNeeds.length > 1 ? 'Medium' : 'Low'}</div>\n                        <div class=\"performance-description\">\n                            ${staff.professionalDevelopment.trainingNeeds.length} training area(s) identified for development\n                        </div>\n                    </div>\n                    \n                    <h4 style=\"color: #FF9800; margin: 20px 0 10px 0;\">Detailed Training Requirements:</h4>\n                    ${staff.professionalDevelopment.trainingNeeds.map(need => `\n                        <div class=\"training-item\">\n                            <div style=\"font-weight: 600; color: #f57c00;\">Training Request</div>\n                            <div style=\"margin-top: 8px;\">\n                                <strong>Areas:</strong> ${need.areas}<br>\n                                <strong>Support Type:</strong> ${need.supportType}<br>\n                                <strong>Date Identified:</strong> ${new Date(need.date).toLocaleDateString()}\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>` : ''}\n        </div>\n        \n        <div class=\"footer\">\n            <div class=\"report-id\">STAFF-${staff.staffCode}-${Date.now()}</div>\n            <div>Generated: ${reportDate} ${reportTime}</div>\n            <div style=\"font-size: 13px; margin-top: 5px; opacity: 0.9;\">\n                Rule-Based Analysis System - Staff Performance Analytics\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n\n    return {\n        staffCode: staff.staffCode,\n        staffName: staff.staffName,\n        filename: `${staff.staffCode}_${staff.staffName.replace(/\\s+/g, '_')}_Weekly_Report_${reportPeriod.startDate.replace(/\\//g, '-')}`,\n        htmlContent: htmlContent\n    };\n}\n\nfunction getPerformanceClass(rating) {\n    if (rating >= 95) return 'excellent';\n    if (rating >= 85) return 'good';\n    if (rating >= 75) return 'needs-attention';\n    return 'critical';\n}\n\nfunction getProgressClass(value) {\n    if (value >= 95) return 'progress-excellent';\n    if (value >= 85) return 'progress-good';\n    if (value >= 75) return 'progress-fair';\n    return 'progress-needs-improvement';\n}\n\nfunction calculateCareQualityScore(staff) {\n    let score = 85; // Base score\n    \n    if (staff.clientCareQuality.medicationManagement > 0) score += 10;\n    if (staff.performanceMetrics.incidentHandling.length > 0) score += 5;\n    if (staff.wellbeingAndSupport.concernsRaised.some(c => c.type === 'general_concern')) score -= 5;\n    \n    return Math.min(100, Math.max(60, score));\n}\n\nfunction calculateReliabilityScore(staff) {\n    let score = 90; // Base score\n    \n    if (staff.totalShifts >= 5) score += 5; // Bonus for consistent work\n    if (staff.professionalDevelopment.trainingNeeds.length === 0) score += 5;\n    if (staff.wellbeingAndSupport.concernsRaised.length > 2) score -= 10;\n    \n    return Math.min(100, Math.max(70, score));\n}\n\nfunction getWorkloadAssessment(staff) {\n    if (staff.clientsWorkedWith.length > 6) return 'High';\n    if (staff.clientsWorkedWith.length > 3) return 'Moderate';\n    return 'Light';\n}\n\nfunction generateStaffStrengths(staff) {\n    const strengths = [];\n    \n    // Base strengths\n    strengths.push(`Successfully completed ${staff.totalShifts} shifts with professional standards`);\n    strengths.push(`Provided quality care to ${staff.clientsWorkedWith.length} different clients`);\n    \n    // Performance-based strengths\n    if (staff.clientCareQuality.medicationManagement > 0) {\n        strengths.push('Demonstrated competency in medication administration and management');\n    }\n    \n    if (staff.performanceMetrics.incidentHandling.length > 0) {\n        strengths.push('Effective crisis management and incident response capabilities');\n    }\n    \n    if (staff.wellbeingAndSupport.concernsRaised.some(c => c.type === 'general_concern')) {\n        strengths.push('Proactive communication and transparency in reporting concerns');\n    }\n    \n    if (staff.professionalDevelopment.trainingNeeds.length > 0) {\n        strengths.push('Self-awareness and commitment to continuous professional development');\n    }\n    \n    if (staff.wellbeingAndSupport.shiftDifficultyRatings.filter(r => r.toLowerCase().includes('good') || r.toLowerCase().includes('excellent')).length > staff.wellbeingAndSupport.shiftDifficultyRatings.length / 2) {\n        strengths.push('Consistent positive shift performance and attitude');\n    }\n    \n    // Default strengths if no specific indicators\n    if (strengths.length === 2) {\n        strengths.push('Maintains professional healthcare standards in all client interactions');\n        strengths.push('Demonstrates reliability and commitment to quality care delivery');\n    }\n    \n    return strengths;\n}\n\nfunction generateDevelopmentRecommendations(staff) {\n    const recommendations = [];\n    \n    // Training-based recommendations\n    if (staff.professionalDevelopment.trainingNeeds.length > 0) {\n        recommendations.push('Prioritize completion of identified training modules within 30 days');\n        recommendations.push('Schedule one-on-one mentoring sessions with senior staff members');\n        recommendations.push('Document training progress and apply new skills in practice');\n    } else {\n        recommendations.push('Continue with regular professional development activities');\n        recommendations.push('Consider pursuing advanced certification in areas of interest');\n    }\n    \n    // Performance-based recommendations\n    if (staff.wellbeingAndSupport.concernsRaised.length > 0) {\n        recommendations.push('Schedule follow-up meeting with supervisor to address reported concerns');\n        recommendations.push('Implement additional support mechanisms for challenging situations');\n        recommendations.push('Develop personalized stress management and coping strategies');\n    }\n    \n    // Workload-based recommendations\n    if (staff.clientsWorkedWith.length > 5) {\n        recommendations.push('Monitor workload distribution to prevent burnout and maintain quality');\n        recommendations.push('Ensure adequate rest periods between intensive shift schedules');\n    }\n    \n    if (staff.totalShifts > 6) {\n        recommendations.push('Assess work-life balance and implement wellbeing check-ins');\n    }\n    \n    // General professional development\n    recommendations.push('Participate actively in team meetings and case discussions');\n    recommendations.push('Share knowledge and mentor junior staff members when appropriate');\n    recommendations.push('Set specific professional goals for the next reporting period');\n    \n    return recommendations;\n}\n\nfunction analyzeShiftPerformance(shiftRatings) {\n    const ratings = {\n        'excellent': 0,\n        'very good': 0,\n        'good': 0,\n        'challenging': 0,\n        'difficult': 0,\n        'very difficult': 0\n    };\n    \n    shiftRatings.forEach(rating => {\n        const lowerRating = rating.toLowerCase();\n        if (lowerRating.includes('excellent')) ratings['excellent']++;\n        else if (lowerRating.includes('very good')) ratings['very good']++;\n        else if (lowerRating.includes('good')) ratings['good']++;\n        else if (lowerRating.includes('challenging')) ratings['challenging']++;\n        else if (lowerRating.includes('very difficult')) ratings['very difficult']++;\n        else if (lowerRating.includes('difficult')) ratings['difficult']++;\n    });\n    \n    const total = shiftRatings.length;\n    const positiveShifts = ratings['excellent'] + ratings['very good'] + ratings['good'];\n    const challengingShifts = ratings['difficult'] + ratings['very difficult'] + ratings['challenging'];\n    \n    let analysis = `${total} shifts completed this week. `;\n    analysis += `${positiveShifts} shifts (${Math.round((positiveShifts/total)*100)}%) rated as good or better. `;\n    \n    if (challengingShifts > 0) {\n        analysis += `${challengingShifts} shifts presented challenges requiring additional support and follow-up.`;\n    } else {\n        analysis += 'No significant difficulties reported - consistent professional performance maintained.';\n    }\n    \n    return analysis;\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2432,
        80
      ],
      "id": "d268c1f1-ce38-49f9-9392-dae6b812fd36",
      "name": "Stylish Weekly Staff Report Generator",
      "retryOnFail": false,
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.pdfshift.io/v3/convert/pdf",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.pdfRequestBody }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1568,
        736
      ],
      "id": "53e79e47-9e9e-4ebf-92eb-7f41169ac446",
      "name": "Generate daily shift report PDF"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.pdfshift.io/v3/convert/pdf",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.pdfRequestBody }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1584,
        992
      ],
      "id": "51156d21-f4aa-42ea-972e-c004b559f339",
      "name": "Generate Incident report PDF"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const formData = $json;\n\n// Extract info\nconst staffName = formData['Staff Full Name'] || 'Unknown Staff';\nconst clientName = formData['Participant Full Name'] || 'Unknown Client';\nconst location = formData['Shift Location'] || '';\nconst cleanClientName = clientName.replace(/[^a-zA-Z0-9]/g, '_');\nconst today = new Date().toISOString().split('T')[0];\nconst timestamp = new Date().toLocaleString();\n\n// Check if incident occurred\nconst hasIncident = formData['Did any incidents occur during this shift?']?.toLowerCase().includes('yes') ||\n                   formData['Incident Date and Time'] ||\n                   formData['Location of Incident'];\n\n// Build incident section ONLY if incident occurred\nlet incidentSection = '';\nif (hasIncident) {\n    incidentSection = `\n\nINCIDENT DURING SHIFT\n---------------------\n‚ö†Ô∏è INCIDENT REPORTED ‚ö†Ô∏è\nDate & Time: ${formData['Incident Date and Time'] || 'Not specified'}\nLocation: ${formData['Location of Incident'] || 'Not specified'}\nPeople Involved: ${formData['People Involved'] || 'Not specified'}\nWhat Happened: ${formData['Describe What Happened'] || 'Not specified'}\nLead-up Events: ${formData['What led up to the incident?'] || 'Not specified'}\nActions Taken: ${formData['Actions Taken / Response'] || 'Not specified'}\nOutcome: ${formData['Outcome of the Incident'] || 'Not specified'}\nReported To: ${formData['Was it reported? If yes, to whom and how?'] || 'Not specified'}\nFollow-up: ${formData['Follow-up / Recommendations'] || 'None specified'}\n`;\n}\n\nconst shiftContent = `\nSHIFT REPORT\n============\n\nCLIENT INFORMATION\n------------------\nClient Name: ${clientName}\nStaff Member: ${staffName}\nLocation: ${location}\nReport Date: ${new Date().toLocaleDateString()}\nShift Period: ${formData['Sign In Date & Time'] || 'Not recorded'} to ${formData['Sign Out Date & Time'] || 'Not recorded'}\n\nHANDOVER INFORMATION\n--------------------\nFrom Previous Shift: ${formData['Handover from previous shift'] || 'No handover notes provided'}\nTo Next Shift: ${formData['Handover to next shift'] || 'No handover notes provided'}\n\nDAILY ACTIVITIES\n----------------\nPersonal Care: ${formData['Daily Activities (including Personal Care)'] || 'Not recorded'}\nActivities: ${formData['Activities'] || 'Not recorded'}\nOther Engagements: ${formData['Other Engagements'] || 'Not recorded'}\nFamily/Social Contacts: ${formData['Family and Social Contacts (Phone/Video Calls)'] || 'No contacts recorded'}\n\nNUTRITION & HYDRATION\n----------------------\nMeal Details: ${formData['Meal Details'] || 'Not recorded'}\nHydration Intake: ${formData['Hydration Intake'] || 'Not recorded'}\nAdequate Intake: ${formData['Did the participant consume adequate food or fluids?'] || 'Not assessed'}\n\nMEDICATION ADMINISTRATION\n-------------------------\n${formData['Were any medications administered during this shift?'] || 'No medications recorded'}\n\nBEHAVIORAL OBSERVATIONS\n-----------------------\nMood/Behavior: ${formData['Behavioural Notes / Mood Observations'] || 'No specific observations'}\nHealth Concerns: ${formData['Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?'] || 'None noted'}${incidentSection}\n\nSHIFT EVALUATION\n----------------\nSupport Needed: ${formData['Did you need any additional support, resources, or information during your shift?'] || 'None needed'}\nShift Rating: ${formData['How did your shift go today?'] || 'Not rated'}\nPositive Highlights: ${formData['Did anything go particularly well during your shift?'] || 'Not specified'}\nAdditional Comments: ${formData['Do you have any additional comments or suggestions for improving future shifts, teamwork, or participant support?'] || 'None provided'}\n\nREPORT DETAILS\n--------------\nGenerated: ${timestamp}\nReport ID: SR-${Date.now()}\nCompleted by: ${staffName}${hasIncident ? '\\n‚ö†Ô∏è NOTE: Separate incident report generated and emailed to management.' : ''}\n`;\n\nreturn {\n    json: {\n        type: 'report',\n        reportType: 'shift',\n        title: `Shift_Report_${cleanClientName}_${today}`,\n        content: shiftContent,\n        clientName: clientName,\n        staffName: staffName\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2672,
        80
      ],
      "id": "cc7e98ae-bfc3-4aa6-b83c-0f4238ef7d5b",
      "name": "check Shift Report"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Get the report data from Shift Report node\nconst reportData = $input.item.json;\n\n// Get the original form data from the Test data node\nconst formData = $json;\n\n// Helper function to check if a field has meaningful data (matching conditional logger logic)\nconst hasValue = (fieldName) => {\n    const value = formData[fieldName];\n    return value && value.trim() !== '' && \n           !value.toLowerCase().includes('not recorded') && \n           !value.toLowerCase().includes('not specified') &&\n           !value.toLowerCase().includes('none') &&\n           !value.toLowerCase().includes('n/a') &&\n           value.trim() !== '-';\n};\n\n// CONDITIONAL LOGIC - Matching the healthcare conditional logger patterns\nconst hasNutritionIssues = formData['Did the participant consume adequate food or fluids?']?.toLowerCase().includes('no');\nconst hasSwallowingDifficulties = formData['Did the participant have any difficulty chewing or swallowing during meals or with fluids?']?.toLowerCase().includes('yes');\nconst hasChokingDiscomfort = formData['Were there any signs of choking, coughing, or discomfort while eating or drinking?']?.toLowerCase().includes('yes');\nconst hasMedicationAdmin = formData['Were any medications administered during this shift?']?.toLowerCase().includes('yes');\nconst hasPRNMeds = hasValue('PRN1 Medication name') || hasValue('PRN2 Medication name') || hasValue('PRN3 Medication name');\nconst hasCommunityIssues = formData['Did the participant participate in any community activities today?']?.toLowerCase().includes('no');\nconst hasCommunityParticipation = formData['Did the participant participate in any community activities today?']?.toLowerCase().includes('yes');\nconst hasIRC = formData['Did you face any issues, risks, or challenges during the shift?']?.toLowerCase().includes('yes');\nconst hasAppointments = formData['Were there any appointments during this shift?']?.toLowerCase().includes('yes');\nconst hasShiftDifficulties = formData['How did your shift go today?']?.toLowerCase().includes('difficult');\nconst hasStaffConcerns = formData['Did you experience any concerns or issues during your shift that you\\'d like to report?']?.toLowerCase().includes('yes');\nconst hasTrainingNeeds = formData['Do you feel you need additional training or support?']?.toLowerCase().includes('yes');\n\n// INCIDENT DETECTION - Exact logic from conditional logger\nconst hasIncident = formData['Did any incidents occur during this shift?']?.toLowerCase().includes('yes') ||\n                   hasValue('Incident Date and Time') ||\n                   hasValue('Location of Incident');\n\n// Basic data sections\nconst hasBasicActivities = hasValue('Daily Activities (including Personal Care)') || hasValue('Activities') || hasValue('Other Engagements');\nconst hasHandover = hasValue('Handover from previous shift') || hasValue('Handover to next shift');\nconst hasBasicNutrition = hasValue('Meal Details') || hasValue('Hydration Intake');\nconst hasBehavioral = hasValue('Behavioural Notes / Mood Observations') || hasValue('Did the participant show any signs of illness, fatigue, anxiety, or safety concerns?');\nconst hasShiftFeedback = hasValue('How did your shift go today?') || hasValue('Did anything go particularly well during your shift?');\nconst hasWellbeingSupport = hasValue('How are you feeling physically and emotionally after this shift?') || hasValue('Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?');\n\n// Check if daily care section has any data\nconst hasDailyCareSection = hasHandover || hasBasicActivities || hasBasicNutrition || hasNutritionIssues || hasSwallowingDifficulties || hasChokingDiscomfort;\n\nconst htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: Arial, sans-serif; \n            line-height: 1.4; \n            color: #333; \n            background: white;\n            padding: 20px;\n            font-size: 11px;\n        }\n        \n        .container {\n            max-width: 210mm;\n            margin: 0 auto;\n            background: white;\n        }\n        \n        .header {\n            text-align: center;\n            margin-bottom: 20px;\n            border-bottom: 3px solid #5B9BD5;\n            padding-bottom: 15px;\n        }\n        \n        .header h1 {\n            color: #2F5597;\n            font-size: 24px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .info-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            border: 2px solid #5B9BD5;\n        }\n        \n        .info-table th,\n        .info-table td {\n            border: 1px solid #5B9BD5;\n            padding: 8px;\n            text-align: left;\n            vertical-align: top;\n            border-bottom: 2px solid #5B9BD5;\n        }\n        \n        .info-table th {\n            background-color: #B4C6E7;\n            color: #2F5597;\n            font-weight: bold;\n            font-size: 10px;\n            width: 25%;\n        }\n        \n        .info-table td {\n            font-size: 10px;\n            background-color: #F2F2F2;\n        }\n        \n        .section-header {\n            background-color: #5B9BD5;\n            color: white;\n            padding: 8px 12px;\n            font-weight: bold;\n            font-size: 13px;\n            margin-top: 20px;\n            margin-bottom: 0;\n            border: 2px solid #5B9BD5;\n            border-bottom: none;\n        }\n        \n        .content-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            border: 2px solid #5B9BD5;\n        }\n        \n        .content-table th,\n        .content-table td {\n            border: 1px solid #5B9BD5;\n            padding: 8px;\n            text-align: left;\n            vertical-align: top;\n            font-size: 10px;\n            border-bottom: 2px solid #5B9BD5;\n        }\n        \n        .content-table th {\n            background-color: #B4C6E7;\n            color: #2F5597;\n            font-weight: bold;\n            width: 35%;\n        }\n        \n        .content-table td {\n            background-color: #F8F9FA;\n        }\n        \n        .content-table tr:nth-child(even) td {\n            background-color: #E7F1FF;\n        }\n        \n        .footer {\n            text-align: center;\n            margin-top: 30px;\n            font-size: 10px;\n            color: #666;\n            border-top: 2px solid #5B9BD5;\n            padding-top: 15px;\n        }\n        \n        @media print {\n            body { padding: 10px; }\n            * { -webkit-print-color-adjust: exact; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>Shift Report</h1>\n        </div>\n        \n        <!-- Basic Information Table -->\n        <table class=\"info-table\">\n            <tr>\n                <th>Participant Full Name</th>\n                <td>${formData['Participant Full Name'] || 'Not specified'}</td>\n                <th>Staff Full Name</th>\n                <td>${formData['Staff Full Name'] || 'Not specified'}</td>\n            </tr>\n            <tr>\n                <th>Shift Location</th>\n                <td colspan=\"3\">${formData['Shift Location'] || 'Not specified'}</td>\n            </tr>\n            <tr>\n                <th>Sign In Date & Time</th>\n                <td>${formData['Sign In Date & Time'] || 'Not recorded'}</td>\n                <th>Sign Out Date & Time</th>\n                <td>${formData['Sign Out Date & Time'] || 'Not recorded'}</td>\n            </tr>\n        </table>\n        \n        <!-- Daily Care Section - Combined handover, activities, and nutrition -->\n        ${hasDailyCareSection ? `\n        <div class=\"section-header\">Daily Care & Activities</div>\n        <table class=\"content-table\">\n            ${hasValue('Handover from previous shift') ? `\n            <tr>\n                <th>Handover from previous shift</th>\n                <td>${formData['Handover from previous shift']}</td>\n            </tr>` : ''}\n            ${hasValue('Handover to next shift') ? `\n            <tr>\n                <th>Handover to next shift</th>\n                <td>${formData['Handover to next shift']}</td>\n            </tr>` : ''}\n            ${hasValue('Daily Activities (including Personal Care)') ? `\n            <tr>\n                <th>Daily Activities (including Personal Care)</th>\n                <td>${formData['Daily Activities (including Personal Care)']}</td>\n            </tr>` : ''}\n            ${hasValue('Activities') ? `\n            <tr>\n                <th>Activities</th>\n                <td>${formData['Activities']}</td>\n            </tr>` : ''}\n            ${hasValue('Other Engagements') ? `\n            <tr>\n                <th>Other Engagements</th>\n                <td>${formData['Other Engagements']}</td>\n            </tr>` : ''}\n            ${hasValue('Family and Social Contacts (Phone/Video Calls)') ? `\n            <tr>\n                <th>Family and Social Contacts (Phone/Video Calls)</th>\n                <td>${formData['Family and Social Contacts (Phone/Video Calls)']}</td>\n            </tr>` : ''}\n            ${hasValue('Behavioural Notes / Mood Observations') ? `\n            <tr>\n                <th>Behavioural Notes / Mood Observations</th>\n                <td>${formData['Behavioural Notes / Mood Observations']}</td>\n            </tr>` : ''}\n            ${hasValue('Meal Details') ? `\n            <tr>\n                <th>Meal Details</th>\n                <td>${formData['Meal Details']}</td>\n            </tr>` : ''}\n            ${hasValue('Hydration Intake') ? `\n            <tr>\n                <th>Hydration Intake</th>\n                <td>${formData['Hydration Intake']}</td>\n            </tr>` : ''}\n            ${hasValue('Did the participant consume adequate food or fluids?') ? `\n            <tr>\n                <th>Adequate food/fluid consumption</th>\n                <td>${formData['Did the participant consume adequate food or fluids?']}</td>\n            </tr>` : ''}\n            ${hasNutritionIssues && hasValue('If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?') ? `\n            <tr>\n                <th>Reason & Actions Taken</th>\n                <td>${formData['If the participant did not consume adequate food or fluids, give the reason for why and what action was taken by staff?']}</td>\n            </tr>` : ''}\n            ${hasSwallowingDifficulties && hasValue('Explain the difficulty in chewing or swallowing experienced during meals and with fluids, and what actions were taken by staff.') ? `\n            <tr>\n                <th>Swallowing Difficulties</th>\n                <td>${formData['Explain the difficulty in chewing or swallowing experienced during meals and with fluids, and what actions were taken by staff.']}</td>\n            </tr>` : ''}\n            ${hasChokingDiscomfort && hasValue('Were there any signs of choking, coughing, or discomfort while eating or drinking? If yes, explain the possible cause and describe the actions taken by staff.') ? `\n            <tr>\n                <th>Choking/Coughing Signs</th>\n                <td>${formData['Were there any signs of choking, coughing, or discomfort while eating or drinking? If yes, explain the possible cause and describe the actions taken by staff.']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Medication Administration - Only show if medications given -->\n        ${hasMedicationAdmin ? `\n        <div class=\"section-header\">Medication Administration</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>Were any medications administered during this shift?</th>\n                <td>${formData['Were any medications administered during this shift?']}</td>\n            </tr>\n            ${hasValue('Medication time') ? `\n            <tr>\n                <th>Medication time</th>\n                <td>${formData['Medication time']}</td>\n            </tr>` : ''}\n            ${hasValue('Medication source') ? `\n            <tr>\n                <th>Medication source</th>\n                <td>${formData['Medication source']}</td>\n            </tr>` : ''}\n            ${hasValue('list all medications administered (if applicable)') ? `\n            <tr>\n                <th>Medications administered</th>\n                <td>${formData['list all medications administered (if applicable)']}</td>\n            </tr>` : ''}\n            ${hasValue('Method of administration') ? `\n            <tr>\n                <th>Method of administration</th>\n                <td>${formData['Method of administration']}</td>\n            </tr>` : ''}\n            ${hasValue('Any issues or observations during administration?') ? `\n            <tr>\n                <th>Issues/Observations</th>\n                <td>${formData['Any issues or observations during administration?']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- PRN Medications - Only show if PRN medications given -->\n        ${hasPRNMeds ? `\n        <div class=\"section-header\">PRN Medications</div>\n        <table class=\"content-table\">\n            ${formData['PRN1 Medication name'] ? `\n            <tr>\n                <th>PRN #1 - ${formData['PRN1 Medication name']}</th>\n                <td>Dose: ${formData['PRN1 Dose'] || 'Not specified'} | Time: ${formData['PRN1 Time given'] || 'Not specified'} | Reason: ${formData['PRN1 Reason for administration'] || 'Not specified'} | Outcome: ${formData['PRN1 Effect/Outcome observed'] || 'Not specified'}</td>\n            </tr>` : ''}\n            ${formData['PRN2 Medication name'] ? `\n            <tr>\n                <th>PRN #2 - ${formData['PRN2 Medication name']}</th>\n                <td>Dose: ${formData['PRN2 Dose'] || 'Not specified'} | Time: ${formData['PRN2 Time given'] || 'Not specified'} | Reason: ${formData['PRN2 Reason for administration'] || 'Not specified'} | Outcome: ${formData['PRN2 Effect/Outcome observed'] || 'Not specified'}</td>\n            </tr>` : ''}\n            ${formData['PRN3 Medication name'] ? `\n            <tr>\n                <th>PRN #3 - ${formData['PRN3 Medication name']}</th>\n                <td>Dose: ${formData['PRN3 Dose'] || 'Not specified'} | Time: ${formData['PRN3 Time given'] || 'Not specified'} | Reason: ${formData['PRN3 Reason for administration'] || 'Not specified'} | Outcome: ${formData['PRN3 Effect/Outcome observed'] || 'Not specified'}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Community Participation - Only show if issues or participation -->\n        ${hasCommunityIssues || hasCommunityParticipation ? `\n        <div class=\"section-header\">Community Participation</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>Did the participant participate in any community activities today?</th>\n                <td>${formData['Did the participant participate in any community activities today?'] || 'Not specified'}</td>\n            </tr>\n            ${hasCommunityIssues && hasValue('Why did the participant not attend the community activity today?') ? `\n            <tr>\n                <th>Reason for non-attendance</th>\n                <td>${formData['Why did the participant not attend the community activity today?']}</td>\n            </tr>` : ''}\n            ${hasCommunityIssues && hasValue('How did the participant respond when the activity was offered?') ? `\n            <tr>\n                <th>Participant response</th>\n                <td>${formData['How did the participant respond when the activity was offered?']}</td>\n            </tr>` : ''}\n            ${hasCommunityIssues && hasValue('What steps or strategies did you take to encourage or motivate participation?') ? `\n            <tr>\n                <th>Strategies used</th>\n                <td>${formData['What steps or strategies did you take to encourage or motivate participation?']}</td>\n            </tr>` : ''}\n            ${hasCommunityParticipation && hasValue('Please specify the activities') ? `\n            <tr>\n                <th>Activities</th>\n                <td>${formData['Please specify the activities']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Appointments - Only show if appointments occurred -->\n        ${hasAppointments ? `\n        <div class=\"section-header\">Appointments</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>Appointment type</th>\n                <td>${formData['Type of Appointment'] || 'Not specified'}</td>\n            </tr>\n            ${hasValue('Purpose of the Appointment') ? `\n            <tr>\n                <th>Purpose</th>\n                <td>${formData['Purpose of the Appointment']}</td>\n            </tr>` : ''}\n            ${hasValue('Name of the Professional Seen') ? `\n            <tr>\n                <th>Professional seen</th>\n                <td>${formData['Name of the Professional Seen']}</td>\n            </tr>` : ''}\n            ${hasValue('Brief Summary of the Appointment') ? `\n            <tr>\n                <th>Summary</th>\n                <td>${formData['Brief Summary of the Appointment']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Incidents Section - Always show with appropriate message -->\n        <div class=\"section-header\">Incidents</div>\n        <table class=\"content-table\">\n            <tr>\n                <th>Did any incidents occur during this shift?</th>\n                <td>${hasIncident ? 'Yes - Separate incident report created for this shift' : 'No incidents reported during this shift'}</td>\n            </tr>\n        </table>\n        \n        <!-- Issues/Risks/Challenges - Only show if IRC reported -->\n        ${hasIRC ? `\n        <div class=\"section-header\">Issues, Risks & Challenges</div>\n        <table class=\"content-table\">\n            ${formData['Type of IRC (Issue/Risk/Challenge) 1'] ? `\n            <tr>\n                <th>${formData['Type of IRC (Issue/Risk/Challenge) 1']} #1</th>\n                <td>${formData['Describe the IRC ( issues, risks, or challenges) 1'] || 'Not described'}</td>\n            </tr>` : ''}\n            ${formData['Type of IRC (Issue/Risk/Challenge) 2'] ? `\n            <tr>\n                <th>${formData['Type of IRC (Issue/Risk/Challenge) 2']} #2</th>\n                <td>${formData['Describe the IRC ( issues, risks, or challenges) 2'] || 'Not described'}</td>\n            </tr>` : ''}\n            ${formData['Type of IRC (Issue/Risk/Challenge) 3'] ? `\n            <tr>\n                <th>${formData['Type of IRC (Issue/Risk/Challenge) 3']} #3</th>\n                <td>${formData['Describe the IRC ( issues, risks, or challenges) 3'] || 'Not described'}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Shift Feedback - Only show if feedback provided -->\n        ${hasShiftFeedback ? `\n        <div class=\"section-header\">Shift Feedback</div>\n        <table class=\"content-table\">\n            ${hasValue('How did your shift go today?') ? `\n            <tr>\n                <th>How did your shift go today?</th>\n                <td>${formData['How did your shift go today?']}</td>\n            </tr>` : ''}\n            ${hasShiftDifficulties && hasValue('If you rated the shift as Difficult or Very Difficult, please explain why.') ? `\n            <tr>\n                <th>Explanation for difficulty</th>\n                <td>${formData['If you rated the shift as Difficult or Very Difficult, please explain why.']}</td>\n            </tr>` : ''}\n            ${hasValue('Did anything go particularly well during your shift?') ? `\n            <tr>\n                <th>Did anything go particularly well during your shift?</th>\n                <td>${formData['Did anything go particularly well during your shift?']}</td>\n            </tr>` : ''}\n            ${hasValue('Did you need any additional support, resources, or information during your shift?') ? `\n            <tr>\n                <th>Additional support needed</th>\n                <td>${formData['Did you need any additional support, resources, or information during your shift?']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Staff Concerns - Only show if concerns reported -->\n        ${hasStaffConcerns ? `\n        <div class=\"section-header\">Staff Concerns</div>\n        <table class=\"content-table\">\n            ${hasValue('Would you like to provide more details about any concerns, issues, or complaints raised during this shift? If yes, please describe what happened and any actions taken.') ? `\n            <tr>\n                <th>Concern details</th>\n                <td>${formData['Would you like to provide more details about any concerns, issues, or complaints raised during this shift? If yes, please describe what happened and any actions taken.']}</td>\n            </tr>` : ''}\n            ${hasValue('Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?') ? `\n            <tr>\n                <th>Management awareness needed</th>\n                <td>${formData['Is there anything important you would like management to be aware of from this shift (e.g., participant needs, incidents, resources, or staff concerns)?']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Training Needs - Only show if training needed -->\n        ${hasTrainingNeeds ? `\n        <div class=\"section-header\">Training Needs</div>\n        <table class=\"content-table\">\n            ${hasValue('Which areas do you feel you need training in?') ? `\n            <tr>\n                <th>Training areas needed</th>\n                <td>${formData['Which areas do you feel you need training in?']}</td>\n            </tr>` : ''}\n            ${hasValue('What type of support would help you most?') ? `\n            <tr>\n                <th>Support type needed</th>\n                <td>${formData['What type of support would help you most?']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Wellbeing & Support - Only show if relevant data exists -->\n        ${hasWellbeingSupport ? `\n        <div class=\"section-header\">Wellbeing & Support</div>\n        <table class=\"content-table\">\n            ${hasValue('How are you feeling physically and emotionally after this shift?') ? `\n            <tr>\n                <th>Staff wellbeing</th>\n                <td>${formData['How are you feeling physically and emotionally after this shift?']}</td>\n            </tr>` : ''}\n            ${hasValue('Do you have any additional comments or suggestions for improving future shifts, teamwork, or participant support?') ? `\n            <tr>\n                <th>Additional comments/suggestions</th>\n                <td>${formData['Do you have any additional comments or suggestions for improving future shifts, teamwork, or participant support?']}</td>\n            </tr>` : ''}\n            ${hasValue('Would you like someone to follow up with you?') ? `\n            <tr>\n                <th>Follow-up requested</th>\n                <td>${formData['Would you like someone to follow up with you?']}</td>\n            </tr>` : ''}\n        </table>` : ''}\n        \n        <!-- Footer -->\n        <div class=\"footer\">\n            <p><strong>Shift Report Generated</strong></p>\n            <p>Participant: ${formData['Participant Full Name'] || 'Unknown'} | Staff: ${formData['Staff Full Name'] || 'Unknown'}</p>\n            <p>Generated: ${new Date().toLocaleDateString()}, ${new Date().toLocaleTimeString()} | Report ID: SR-${Date.now()}</p>\n        </div>\n    </div>\n</body>\n</html>`;\n\n// Create clean filename matching incident report format\nconst clientName = formData['Participant Full Name'] || 'Unknown_Client';\nconst cleanClientName = clientName.replace(/[^a-zA-Z0-9]/g, '_');\n\n// Extract shift date from Sign In Date & Time field\nconst shiftDateTime = formData['Sign In Date & Time'] || '';\nconst shiftDate = shiftDateTime.split(' ')[0] || new Date().toISOString().split('T')[0];\n\nconst shiftReportTitle = `Shift_Report_${cleanClientName}_${shiftDate}`;\n\nconst requestBody = {\n    source: htmlContent,\n    format: \"A4\",\n    margin: \"0.4cm\",\n    landscape: false\n};\n\nreturn {\n    json: {\n        ...reportData,\n        pdfRequestBody: requestBody,\n        title: shiftReportTitle,\n        clientName: clientName,\n        reportDate: shiftDate\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1296,
        704
      ],
      "id": "5839dfd6-aaac-47c7-8471-cf205073f1ca",
      "name": "Shift Report Format"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        80
      ],
      "id": "91422d5c-50c2-4930-aac4-6ae8d0714d3b",
      "name": "Staff Email Lookup",
      "executeOnce": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// QUALITY CHECK & SCORING SYSTEM v1.0\n\nconst formData = $json;\n\n// Initialize scoring\nlet qualityScore = 100;\nconst issues = [];\nconst warnings = [];\n\n// Helper function\nconst hasValue = (field) => {\n    const val = formData[field];\n    return val && String(val).trim() !== '' && \n           !['n/a', 'na', 'none', 'nil', 'no', 'nothing'].includes(String(val).toLowerCase().trim());\n};\n\n// ============================================\n// CHECK 1: LAZY HANDOVERS (-25 points)\n// ============================================\nconst handoverNext = String(formData['Handover to next shift'] || '').toLowerCase().trim();\nconst handoverPrev = String(formData['Handover from previous shift'] || '').toLowerCase().trim();\n\nconst lazyPhrases = ['all good', 'n/a', 'nothing', 'nil', 'no', 'good'];\nconst isLazyHandover = lazyPhrases.some(p => handoverNext === p || handoverNext === p + '...');\n\nif (isLazyHandover) {\n    issues.push(\"‚ùå Handover: Too generic. Provide specific updates (medications, mood changes, concerns)\");\n    qualityScore -= 25;\n}\n\n// ============================================\n// CHECK 2: BRIEF ACTIVITIES (-20 points)\n// ============================================\nconst activities = String(formData['Daily Activities (including Personal Care)'] || '');\n\nif (activities.length === 0) {\n    issues.push(\"‚ùå Activities: Field is empty - this is a required field\");\n    qualityScore -= 30;\n} else if (activities.length < 50) {\n    issues.push(\"‚ùå Activities: Too brief (\" + activities.length + \" chars). Describe specifically what care was provided\");\n    qualityScore -= 20;\n} else if (activities.length < 100) {\n    warnings.push(\"‚ö†Ô∏è Activities could be more detailed (current: \" + activities.length + \" chars, good: 100+)\");\n}\n\n// ============================================\n// CHECK 3: MISSING BEHAVIORAL NOTES (-15 points)\n// ============================================\nconst behavioral = String(formData['Behavioural Notes / Mood Observations'] || '').toLowerCase().trim();\n\nif (!hasValue('Behavioural Notes / Mood Observations') || \n    behavioral === 'none' || behavioral === 'nil' || behavioral === 'no') {\n    issues.push(\"‚ùå Behavioral Notes: Add participant's mood, behavior, or wellbeing observations\");\n    qualityScore -= 15;\n}\n\n// ============================================\n// CHECK 4: VAGUE MEAL DETAILS (-10 points)\n// ============================================\nconst meals = String(formData['Meal Details'] || '');\n\nif (meals.length > 0 && meals.length < 20) {\n    issues.push(\"‚ùå Meal Details: Too brief. Specify what was eaten and approximate amounts\");\n    qualityScore -= 10;\n}\n\n// ============================================\n// CHECK 5: COPY-PASTE DETECTION (-30 points)\n// ============================================\n// Check for common copy-pasted phrases\nconst copyPasteSignals = [\n    'i start with check her diabetes thn i massaged',\n    'today i start my morning shift with le ann at 8am',\n    'i commenced my night shift at 9:00 pm'\n];\n\nconst isCopyPasted = copyPasteSignals.some(phrase => \n    activities.toLowerCase().includes(phrase)\n);\n\nif (isCopyPasted) {\n    issues.push(\"üö® CRITICAL: Appears to be copy-pasted from another shift. Write original documentation\");\n    qualityScore -= 30;\n}\n\n// ============================================\n// CHECK 6: INCIDENT COMPLETENESS\n// ============================================\nconst hasIncident = formData['Did any incidents occur during this shift?']?.toLowerCase().includes('yes');\n\nif (hasIncident) {\n    const incidentDesc = String(formData['Describe What Happened'] || '');\n    if (incidentDesc.length < 50) {\n        issues.push(\"üö® CRITICAL: Incident description too brief. Provide detailed STAR documentation\");\n        qualityScore -= 40;\n    }\n}\n\n// ============================================\n// DETERMINE QUALITY TIER\n// ============================================\nlet qualityTier;\nlet needsManagerAlert = false;\n\nif (qualityScore >= 90) {\n    qualityTier = \"EXCELLENT\";\n} else if (qualityScore >= 70) {\n    qualityTier = \"GOOD\";\n} else if (qualityScore >= 50) {\n    qualityTier = \"POOR\";\n} else {\n    qualityTier = \"CRITICAL\";\n    needsManagerAlert = true;\n}\n\n// ============================================\n// LOGGING OUTPUT\n// ============================================\nconsole.log(\"\\n=== QUALITY CHECK RESULTS ===\");\nconsole.log(`Staff: ${formData['Staff Full Name']}`);\nconsole.log(`Participant: ${formData['Participant Full Name']}`);\nconsole.log(`Quality Score: ${qualityScore}/100 (${qualityTier})`);\nconsole.log(`Issues Found: ${issues.length}`);\nconsole.log(`Warnings: ${warnings.length}`);\n\nif (issues.length > 0) {\n    console.log(\"\\nISSUES:\");\n    issues.forEach(i => console.log(`  ${i}`));\n}\n\nif (warnings.length > 0) {\n    console.log(\"\\nWARNINGS:\");\n    warnings.forEach(w => console.log(`  ${w}`));\n}\n\n// ============================================\n// RETURN ENRICHED DATA\n// ============================================\nreturn {\n    ...formData,\n    qualityScore: qualityScore,\n    qualityTier: qualityTier,\n    qualityIssues: issues,\n    qualityWarnings: warnings,\n    needsStaffFeedback: qualityScore < 70,\n    needsManagerAlert: needsManagerAlert,\n    issueCount: issues.length,\n    qualityCheckDate: new Date().toISOString()\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        848
      ],
      "id": "5fa463a6-fd8a-44a3-aee9-db3884c27cb4",
      "name": "Quality Check Code",
      "retryOnFail": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// NAMECODEMANAGER v2.1 - Ultra Robust Case & Punctuation Handler\n\nclass NameCodeManager {\n    constructor() {\n        this.clientMappings = {\n            'CT001': {\n                primary: 'Andrew Zhotchenko',\n                variations: [\n                    'andrew', 'andre', 'andrey', 'aundrey', 'audrey',\n                    'andrew zhotchenko', 'andrew zotchenko',\n                    'zhotchenko', 'zotchenko'\n                ]\n            },\n            \n            'CT002': {\n                primary: 'Jose Correia',\n                variations: [\n                    'jose', 'jose correia', 'jose corria', \n                    'jose carriea', 'jose carreia',\n                    'correia', 'corria', 'carriea', 'carreia'\n                ]\n            },\n            \n            'CT003': {\n                primary: 'Joseph Khoury',\n                variations: [\n                    'joseph khoury', 'joseph k', 'joseph khory',\n                    'joshep k', 'josh', 'josh c',\n                    'joseph', 'joe khoury',\n                    'khoury', 'choury'\n                ]\n            },\n            \n            'CT004': {\n                primary: 'Le Ann Jacobs',\n                variations: [\n                    'le ann', 'le aann', 'leann', 'lea nn',\n                    'le ann jacobs', 'le ann jacombs',\n                    'les aan', 'lee ann', 'la ann',\n                    'jacobs', 'jacombs', 'jacob'\n                ]\n            },\n            \n            'CT005': {\n                primary: 'Maen Maatouk',\n                variations: [\n                    'maen', 'main', 'mayen',\n                    'maen maatouk', 'maen mastouk', 'maen matouk',\n                    'maatouk', 'mastouk', 'matouk'\n                ]\n            },\n            \n            'CT006': {\n                primary: 'Suraya Zaheer',\n                variations: [\n                    'suraya', 'surya', 'sur', 'surya zameel',\n                    'suraya zaheer', 'suraya zahir',\n                    'surya zaheer', 'surya zahir',\n                    'suraya zahar', 'surya zahar',\n                    'zaheer', 'zahar', 'zahir',\n                    'zameel', 'zamel', 'zameal'\n                ]\n            },\n            \n            'CT007': {\n                primary: 'Teana Harrison',\n                variations: [\n                    'teana', 'tiana', 'teanna',\n                    'teana harrison', 'tiana harrison',\n                    'harrison', 'harisson'\n                ]\n            }\n        };\n    }\n\n    findClientCode(name) {\n        if (!name) {\n            return { code: 'CT999', matched: false, primary: 'Unknown Client' };\n        }\n        \n        const codeMatch = name.toString().toUpperCase().match(/CT\\d+/);\n        if (codeMatch) {\n            return { code: codeMatch[0], matched: true, primary: name };\n        }\n        \n        const clean = this.cleanName(name);\n        \n        if (clean.includes('and')) {\n            console.log(`‚ö†Ô∏è Combined entry: \"${name}\"`);\n            const parts = clean.split('and').map(p => p.trim());\n            \n            for (const part of parts) {\n                for (const [code, data] of Object.entries(this.clientMappings)) {\n                    if (data.variations.some(v => this.fuzzyMatch(part, v))) {\n                        console.log(`~ Using \"${part}\" from combined: ${code} (${data.primary})`);\n                        return { code, primary: data.primary, matched: true };\n                    }\n                }\n            }\n        }\n        \n        for (const [code, data] of Object.entries(this.clientMappings)) {\n            if (data.variations.includes(clean)) {\n                console.log(`‚úì Exact match: \"${name}\" ‚Üí ${code} (${data.primary})`);\n                return { code, primary: data.primary, matched: true };\n            }\n        }\n\n        for (const [code, data] of Object.entries(this.clientMappings)) {\n            for (const variation of data.variations) {\n                if (this.fuzzyMatch(clean, variation)) {\n                    console.log(`~ Fuzzy match: \"${name}\" ‚Üí ${code} (${data.primary})`);\n                    return { code, primary: data.primary, matched: true };\n                }\n            }\n        }\n\n        console.log(`‚úó UNMATCHED: \"${name}\" ‚Üí CT999`);\n        return { code: 'CT999', matched: false, primary: name };\n    }\n\n    cleanName(name) {\n        if (!name) return '';\n        \n        return name.toString()\n            .toLowerCase()\n            .trim()\n            .replace(/[.,\\/#!$%\\^&\\*;:{}=\\-_`~()]/g, '')\n            .replace(/\\s+/g, ' ')\n            .trim();\n    }\n\n    fuzzyMatch(input, target) {\n        if (input.length < 3 || target.length < 3) {\n            return false;\n        }\n        \n        if (input.includes(target) || target.includes(input)) {\n            return true;\n        }\n        \n        if (input.length >= 4 && Math.abs(input.length - target.length) <= 2) {\n            let differences = 0;\n            const maxLen = Math.max(input.length, target.length);\n            \n            for (let i = 0; i < maxLen; i++) {\n                if (input[i] !== target[i]) differences++;\n                if (differences > 2) return false;\n            }\n            \n            return differences <= 2;\n        }\n        \n        return false;\n    }\n}\n\nconst nameManager = new NameCodeManager();\nconst response = $json;\n\nfunction cleanData(value, defaultValue = 'Not specified') {\n    if (!value || value.toString().trim() === '' || \n        value.toString().toLowerCase().includes('not recorded') ||\n        value.toString().toLowerCase().includes('not specified') ||\n        value.toString().toLowerCase().includes('none')) {\n        return defaultValue;\n    }\n    return value.toString().trim();\n}\n\nconst originalClientName = cleanData(response['Participant Full Name']);\nconst clientResult = nameManager.findClientCode(originalClientName);\n\nconsole.log(`\\n=== NAME PROCESSING v2.1 ===`);\nconsole.log(`Input: \"${originalClientName}\"`);\nconsole.log(`Cleaned: \"${nameManager.cleanName(originalClientName)}\"`);\nconsole.log(`Result: ${clientResult.code} - ${clientResult.primary}`);\nconsole.log(`Status: ${clientResult.matched ? '‚úì MATCHED' : '‚úó UNMATCHED'}`);\n\nreturn {\n    ...response,\n    clientCode: clientResult.code,\n    clientName: clientResult.primary,\n    originalClientName: originalClientName,\n    clientMatched: clientResult.matched\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        864,
        736
      ],
      "id": "19b30daf-2a31-4c39-afa9-124d27aefe36",
      "name": "Real NameCode Manger"
    },
    {
      "parameters": {
        "content": "## Trigger & Input\n",
        "height": 336,
        "width": 432
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        48,
        768
      ],
      "id": "7cfe91b1-4e82-4097-a1af-1a010609a600",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "",
          "mode": "name",
          "cachedResultName": "",
          "cachedResultUrl": ""
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        288,
        880
      ],
      "id": "c1d3f4cf-3e24-4a93-acbd-efd667ac5fd0",
      "name": "Get row(s) in sheet2"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        96,
        880
      ],
      "id": "4ac27d7d-9369-42fa-bbb4-0fd0fd7ec309",
      "name": "Daily Shift Report and Logging"
    },
    {
      "parameters": {
        "sendTo": "={{ $json[\"staffEmails\"] }}",
        "subject": "=Shift Feedback - {{ $json['Participant Full Name'] }} ({{ $json['Sign In Date & Time']?.split(' ')[0] }}) - {{ $json.qualityScore }}/100",
        "message": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #f5f5f5; padding: 15px;\">\n  \n  <div style=\"background: #667eea; color: white; padding: 20px; border-radius: 8px 8px 0 0; text-align: center;\">\n    <h2 style=\"margin: 0; font-size: 22px;\">Shift Documentation Feedback</h2>\n  </div>\n\n  <div style=\"background: white; padding: 25px; border-radius: 0 0 8px 8px;\">\n    \n    <p style=\"color: #333;\">Hi <strong>{{ $json['Staff Full Name'] }}</strong>,</p>\n    \n    <p style=\"color: #666; font-size: 14px;\">\n      Shift: <strong>{{ $json['Sign In Date & Time'] }}</strong><br>\n      Participant: <strong>{{ $json['Participant Full Name'] }}</strong>\n    </p>\n\n    <div style=\"background: #667eea; color: white; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0;\">\n      <div style=\"font-size: 42px; font-weight: bold;\">{{ $json.qualityScore }}<span style=\"font-size: 24px;\">/100</span></div>\n      <div style=\"font-size: 16px; opacity: 0.9;\">{{ $json.qualityTier }}</div>\n    </div>\n\n    <div style=\"background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 15px 0;\">\n      <p style=\"margin: 5px 0;\"><strong>Issues Found:</strong> {{ $json.issueCount }}</p>\n      <p style=\"margin: 5px 0;\"><strong>Target:</strong> 70+ is GOOD</p>\n    </div>\n\n    <div style=\"margin: 20px 0;\">\n      <h3 style=\"color: #dc3545; font-size: 18px;\">Areas for Improvement</h3>\n      <div style=\"background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 4px;\">\n        {{ $json.qualityIssues[0] ? '<p style=\"margin: 8px 0;\">‚Ä¢ ' + $json.qualityIssues[0] + '</p>' : '' }}\n        {{ $json.qualityIssues[1] ? '<p style=\"margin: 8px 0;\">‚Ä¢ ' + $json.qualityIssues[1] + '</p>' : '' }}\n        {{ $json.qualityIssues[2] ? '<p style=\"margin: 8px 0;\">‚Ä¢ ' + $json.qualityIssues[2] + '</p>' : '' }}\n      </div>\n    </div>\n\n    <div style=\"margin: 25px 0;\">\n      <h3 style=\"color: #667eea; font-size: 18px;\">Examples: Poor vs Good</h3>\n\n      <div style=\"margin: 15px 0; border: 1px solid #ddd; border-radius: 6px;\">\n        <div style=\"background: #f8f9fa; padding: 10px; font-weight: bold; border-bottom: 1px solid #ddd;\">Activities</div>\n        <div style=\"padding: 12px;\">\n          <p style=\"color: #dc3545; margin: 5px 0; font-size: 14px;\"><strong>‚ùå</strong> \"Helped with shower. Made lunch.\"</p>\n          <p style=\"color: #28a745; margin: 5px 0; font-size: 14px;\"><strong>‚úÖ</strong> \"Assisted with shower at 8am, chose blue shirt. Did 2 loads laundry 10am-12pm. Made chicken salad for lunch 12:30pm.\"</p>\n        </div>\n      </div>\n\n      <div style=\"margin: 15px 0; border: 1px solid #ddd; border-radius: 6px;\">\n        <div style=\"background: #f8f9fa; padding: 10px; font-weight: bold; border-bottom: 1px solid #ddd;\">Behavioral Notes</div>\n        <div style=\"padding: 12px;\">\n          <p style=\"color: #dc3545; margin: 5px 0; font-size: 14px;\"><strong>‚ùå</strong> \"Good mood. No issues.\"</p>\n          <p style=\"color: #28a745; margin: 5px 0; font-size: 14px;\"><strong>‚úÖ</strong> \"Cheerful today, talkative about family visit. Engaged well during meals. Mood positive throughout shift.\"</p>\n        </div>\n      </div>\n\n      <div style=\"margin: 15px 0; border: 1px solid #ddd; border-radius: 6px;\">\n        <div style=\"background: #f8f9fa; padding: 10px; font-weight: bold; border-bottom: 1px solid #ddd;\">Meals</div>\n        <div style=\"padding: 12px;\">\n          <p style=\"color: #dc3545; margin: 5px 0; font-size: 14px;\"><strong>‚ùå</strong> \"Had breakfast and lunch.\"</p>\n          <p style=\"color: #28a745; margin: 5px 0; font-size: 14px;\"><strong>‚úÖ</strong> \"Breakfast 8:30am: 2 eggs, toast, tea. Ate 80%. Lunch 12:30pm: Curry with rice. Finished meal.\"</p>\n        </div>\n      </div>\n\n      <div style=\"margin: 15px 0; border: 1px solid #ddd; border-radius: 6px;\">\n        <div style=\"background: #f8f9fa; padding: 10px; font-weight: bold; border-bottom: 1px solid #ddd;\">Handover</div>\n        <div style=\"padding: 12px;\">\n          <p style=\"color: #dc3545; margin: 5px 0; font-size: 14px;\"><strong>‚ùå</strong> \"All good. Nothing to report.\"</p>\n          <p style=\"color: #28a745; margin: 5px 0; font-size: 14px;\"><strong>‚úÖ</strong> \"Meds 8:15am ok. Good appetite. Rest 2-3pm. Lower energy evening - monitor. Med due 6pm.\"</p>\n        </div>\n      </div>\n\n    </div>\n\n    <div style=\"background: #e7f3ff; border-left: 4px solid #2196F3; padding: 15px; border-radius: 4px; margin: 20px 0;\">\n      <h4 style=\"margin: 0 0 10px 0; font-size: 16px;\">Quick Tips</h4>\n      <ul style=\"margin: 5px 0; padding-left: 20px; font-size: 14px; line-height: 1.6;\">\n        <li>Include times and specific details</li>\n        <li>Note mood and behavior changes</li>\n        <li>Write 100+ characters per section</li>\n        <li>Never copy from other shifts</li>\n      </ul>\n    </div>\n\n    <div style=\"background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 20px 0; font-size: 14px;\">\n      <strong>Score Guide:</strong>\n      <div style=\"margin: 10px 0;\">\n        <span style=\"color: #28a745; font-weight: bold;\">90-100 EXCELLENT</span> | \n        <span style=\"color: #17a2b8; font-weight: bold;\">70-89 GOOD</span> | \n        <span style=\"color: #ffc107; font-weight: bold;\">50-69 POOR</span> | \n        <span style=\"color: #dc3545; font-weight: bold;\">&lt;50 CRITICAL</span>\n      </div>\n    </div>\n\n    <div style=\"text-align: center; padding: 15px; background: #f8f9fa; border-radius: 6px; font-size: 13px; color: #666;\">\n      Questions? Speak with your supervisor.\n    </div>\n\n  </div>\n\n  <div style=\"text-align: center; padding: 15px; color: #999; font-size: 11px;\">\n    <p style=\"margin: 3px 0;\">Automated Quality Assessment</p>\n    <p style=\"margin: 3px 0;\">Young Logix</p>\n  </div>\n\n</div>",
        "options": {
          "appendAttribution": true
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1120,
        1072
      ],
      "id": "971a234a-e1f1-489d-bc90-6deca31d8fb9",
      "name": "Send Feedback to Staff",
      "webhookId": "e4ea99f8-07d8-4039-a40d-9079bce977bc",
      "executeOnce": false
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Performance Log",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Date": "={{ $json.qualityCheckDate }}",
            "Staff Name": "={{ $json['Staff Full Name'] }}",
            "Participant": "={{ $json['Participant Full Name'] }}",
            "Quality Score": "={{ $json.qualityScore }}",
            "Quality Tier": "={{ $json.qualityTier }}",
            "Issues": "={{ $json.issueCount }}",
            "Warnings": "={{ $json.qualityWarnings.length }}",
            "Shift Time": "={{ $json['Sign In Date & Time'] }}",
            "Issue Details": "={{ $json.qualityIssues.join(' | ') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Staff Name",
              "displayName": "Staff Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Participant",
              "displayName": "Participant",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Quality Score",
              "displayName": "Quality Score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Quality Tier",
              "displayName": "Quality Tier",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Issues",
              "displayName": "Issues",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Warnings",
              "displayName": "Warnings",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shift Time",
              "displayName": "Shift Time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Issue Details",
              "displayName": "Issue Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        848,
        896
      ],
      "id": "3ed07295-7e21-495c-995e-9f10e1cd3ab0",
      "name": "Staff Shift Report Performance Log"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8e6e7246-86b6-42e6-92cc-1d6004f0d9bd",
              "leftValue": "={{ {'aanchal ritu': 'akash.kunwar@younglogix.com.au', 'anjaii mothsra': '', 'ankita': ''}[($json['Staff Full Name'] || '').toLowerCase().trim()] }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        832,
        1088
      ],
      "id": "5a1a22aa-62b9-45bb-b090-62f161e9b8a1",
      "name": "Condition for Checking Empty Staff Emails"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "6d7671cd-ee2f-4532-a89a-2cf883ab2892",
              "leftValue": "={{ $json[\"Did any incidents occur during this shift?\"].toLowerCase().trim().includes('yes') }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1072,
        880
      ],
      "id": "fbcfd9c6-c808-459e-abcd-deb9f679c565",
      "name": "Condition for Checking Incident Occurred during Shift"
    }
  ],
  "pinData": {},
  "connections": {
    "Save Shift Report": {
      "main": [
        [
          {
            "node": "Log Shift Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Incident Report": {
      "main": [
        [
          {
            "node": "Log Incident Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Incident Report": {
      "main": [
        [
          {
            "node": "Log Incident Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Conditional Logger": {
      "main": [
        [
          {
            "node": "Route By Sheet Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Conditional Logger",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me2": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route By Sheet Name": {
      "main": [
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clean Data Node",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Universal Append": {
      "main": [
        [
          {
            "node": "End of Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean Data Node": {
      "main": [
        [
          {
            "node": "Universal Append",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Shift Report Folder ID": {
      "main": [
        [
          {
            "node": "Save Shift Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Incident Report Folder ID": {
      "main": [
        [
          {
            "node": "Save Incident Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Shift Report": {
      "main": [
        [
          {
            "node": "Logging Daily Shift Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Incident Report": {
      "main": [
        [
          {
            "node": "Logging Incident Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Incident Email": {
      "main": [
        [
          {
            "node": "Logging Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate daily shift report PDF": {
      "main": [
        [
          {
            "node": "Get Shift Report Folder ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Incident report PDF": {
      "main": [
        [
          {
            "node": "Email Incident Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Incident Report Folder ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Quality Check Code": {
      "main": [
        [
          {
            "node": "Real NameCode Manger",
            "type": "main",
            "index": 0
          },
          {
            "node": "Staff Shift Report Performance Log",
            "type": "main",
            "index": 0
          },
          {
            "node": "Condition for Checking Empty Staff Emails",
            "type": "main",
            "index": 0
          },
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Real NameCode Manger": {
      "main": [
        [
          {
            "node": "Shift Report Format",
            "type": "main",
            "index": 0
          },
          {
            "node": "Condition for Checking Incident Occurred during Shift",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Quality Check Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Daily Shift Report and Logging": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Condition for Checking Empty Staff Emails": {
      "main": [
        [
          {
            "node": "Send Feedback to Staff",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Condition for Checking Incident Occurred during Shift": {
      "main": [
        [
          {
            "node": "Incident Report Format",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shift Report Format": {
      "main": [
        [
          {
            "node": "Generate daily shift report PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Incident Report Format": {
      "main": [
        [
          {
            "node": "Generate Incident report PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "5e3f1cc8-9dae-4bdd-bd1b-dddf5f2b4e4d",
  "meta": {
    "instanceId": "5044d66d9273533da3f1ecb80ddf5c8ea534ffba5263f12766b626844c571974"
  },
  "id": "9GlQGK057e1qcGO7",
  "tags": []
}